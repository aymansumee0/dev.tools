<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø°ÙƒÙŠ</title>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap');
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
      -webkit-user-select: none;
    }
    
    :root {
      --primary: #2C3E94;
      --success: #059669;
      --danger: #dc2626;
      --warning: #d97706;
      --bg-card: #ffffff;
      --text-primary: #1a1a2e;
      --text-secondary: #5a5a7a;
      --shadow: 0 4px 20px rgba(44, 62, 148, 0.15);
    }
    
    body {
      font-family: 'Cairo', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      direction: rtl;
    }
    
    .container {
      max-width: 480px;
      margin: 0 auto;
      padding: 20px;
      min-height: 100vh;
    }
    
    /* Ø§Ù„ØµÙØ­Ø§Øª */
    .page {
      display: none;
      animation: fadeIn 0.4s ease;
    }
    
    .page.active {
      display: block;
    }
    
    /* ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
    .login-card {
      background: var(--bg-card);
      border-radius: 20px;
      padding: 30px;
      margin-top: 50px;
      box-shadow: var(--shadow);
      text-align: center;
    }
    
    .logo {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, var(--primary), #764ba2);
      border-radius: 20px;
      margin: 0 auto 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
      color: white;
    }
    
    .login-title {
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--text-primary);
      margin-bottom: 8px;
    }
    
    .input-group {
      margin: 15px 0;
      text-align: right;
    }
    
    .input-group label {
      display: block;
      font-weight: 700;
      color: var(--text-secondary);
      margin-bottom: 6px;
      font-size: 0.85rem;
    }
    
    .input-field {
      width: 100%;
      padding: 14px;
      border: 2px solid #e0e2e8;
      border-radius: 12px;
      font-size: 1rem;
      font-family: 'Cairo', sans-serif;
      text-align: center;
      background: #f8f9fa;
    }
    
    .input-field:focus {
      outline: none;
      border-color: var(--primary);
      background: white;
    }
    
    .btn-primary {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, var(--primary), #764ba2);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 800;
      cursor: pointer;
      margin-top: 15px;
      font-family: 'Cairo', sans-serif;
    }
    
    /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
    .header {
      background: rgba(255,255,255,0.95);
      border-radius: 16px;
      padding: 15px 20px;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: var(--shadow);
    }
    
    .student-info h3 {
      font-size: 0.95rem;
      color: var(--text-primary);
    }
    
    .student-info p {
      font-size: 0.75rem;
      color: var(--text-secondary);
    }
    
    /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… */
    .progress-bar {
      background: var(--bg-card);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: var(--shadow);
    }
    
    .progress-header {
      display: flex;
      justify-content: space-between;
      font-weight: 700;
      color: var(--text-secondary);
      font-size: 0.85rem;
      margin-bottom: 10px;
    }
    
    .progress-track {
      height: 8px;
      background: #e0e2e8;
      border-radius: 4px;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), #764ba2);
      border-radius: 4px;
      transition: width 0.5s ease;
    }
    
    /* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ */
    .quiz-card {
      background: var(--bg-card);
      border-radius: 20px;
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: var(--shadow);
    }
    
    .question-number {
      display: inline-block;
      background: linear-gradient(135deg, var(--primary), #764ba2);
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 800;
      margin-bottom: 12px;
    }
    
    .question-text {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text-primary);
      line-height: 1.6;
      margin-bottom: 20px;
    }
    
    /* Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© - 3 Ø®ÙŠØ§Ø±Ø§Øª ÙÙ‚Ø· */
    .options {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .option {
      background: #f8f9fa;
      border: 2px solid #e0e2e8;
      border-radius: 12px;
      padding: 15px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .option:hover {
      border-color: var(--primary);
      background: #f0f2f5;
    }
    
    .option.selected {
      border-color: var(--primary);
      background: rgba(44, 62, 148, 0.05);
    }
    
    .option-letter {
      width: 32px;
      height: 32px;
      background: white;
      border: 2px solid #e0e2e8;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      color: var(--text-secondary);
      font-size: 0.9rem;
      flex-shrink: 0;
    }
    
    .option.selected .option-letter {
      background: var(--primary);
      border-color: var(--primary);
      color: white;
    }
    
    /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ */
    .nav-buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    .btn-nav {
      flex: 1;
      padding: 14px;
      border: none;
      border-radius: 12px;
      font-size: 0.95rem;
      font-weight: 800;
      cursor: pointer;
      font-family: 'Cairo', sans-serif;
    }
    
    .btn-prev {
      background: #f0f2f5;
      color: var(--text-secondary);
    }
    
    .btn-next, .btn-submit {
      background: linear-gradient(135deg, var(--primary), #764ba2);
      color: white;
    }
    
    /* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø© */
    .result-card {
      background: var(--bg-card);
      border-radius: 20px;
      padding: 40px 30px;
      text-align: center;
      box-shadow: var(--shadow);
      margin-top: 50px;
    }
    
    .result-icon {
      font-size: 80px;
      margin-bottom: 20px;
    }
    
    .result-title {
      font-size: 1.5rem;
      font-weight: 800;
      margin-bottom: 15px;
    }
    
    .result-message {
      color: var(--text-secondary);
      font-size: 1rem;
      line-height: 1.8;
      margin-bottom: 25px;
    }
    
    .success-box {
      background: #d1fae5;
      border: 2px solid var(--success);
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
      animation: pulse 2s infinite;
    }
    
    .success-text {
      color: var(--success);
      font-weight: 800;
      font-size: 1.2rem;
    }
    
    /* Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      padding: 20px;
    }
    
    .modal-overlay.active {
      display: flex;
    }
    
    .modal-content {
      background: white;
      border-radius: 20px;
      padding: 30px;
      width: 100%;
      max-width: 340px;
      text-align: center;
    }
    
    .modal-icon {
      font-size: 60px;
      margin-bottom: 15px;
    }
    
    .modal-title {
      font-size: 1.3rem;
      font-weight: 800;
      margin-bottom: 10px;
    }
    
    .modal-text {
      color: var(--text-secondary);
      margin-bottom: 20px;
    }
    
    .modal-btn {
      padding: 12px 30px;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 800;
      cursor: pointer;
      font-family: 'Cairo', sans-serif;
      margin: 5px;
    }
    
    .modal-btn-confirm {
      background: linear-gradient(135deg, var(--primary), #764ba2);
      color: white;
    }
    
    .modal-btn-cancel {
      background: #f0f2f5;
      color: var(--text-secondary);
    }
    
    /* Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª */
    .alert {
      position: fixed;
      top: 20px;
      right: 20px;
      left: 20px;
      background: white;
      padding: 16px 20px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
      display: none;
      z-index: 3000;
      border-right: 4px solid;
    }
    
    .alert.show {
      display: block;
    }
    
    .alert.error { border-right-color: var(--danger); }
    .alert.success { border-right-color: var(--success); }
    
    /* Ø­Ù…Ø§ÙŠØ© */
    .security-notice {
      background: #fee2e2;
      border: 1px solid var(--danger);
      border-radius: 10px;
      padding: 12px;
      margin-top: 15px;
      font-size: 0.8rem;
      color: var(--danger);
    }
    
    /* ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø®Ø±ÙˆØ¬ */
    .exit-warning {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(220, 38, 38, 0.95);
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 5000;
      color: white;
      text-align: center;
      padding: 40px;
    }
    
    .exit-warning.active {
      display: flex;
    }
    
    .exit-warning-icon {
      font-size: 80px;
      margin-bottom: 20px;
    }
    
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.02); } }
  </style>
</head>
<body>

<div class="container">
  
  <!-- ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
  <div id="loginPage" class="page active">
    <div class="login-card">
      <div class="logo">ğŸ“</div>
      <h1 class="login-title">Ø¬Ø±Ø§ÙÙŠÙƒØ³ Ø§Ù„Ø¬ÙˆØ§Ù„</h1>
      <h3 class="login-title">Ø§Ù„Ù…Ø³ØªÙˆÙ‰  Ø§Ù„Ø§ÙˆÙ„</h3>
    
    
      
      <div class="input-group">
        <label>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ</label>
        <input type="text" id="loginId" class="input-field" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù…Ùƒ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ" />
      </div>
      
      <div class="input-group">
        <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
        <input type="password" id="loginPass" class="input-field" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" />
      </div>
      
      <button class="btn-primary" onclick="handleLogin()">Ø¯Ø®ÙˆÙ„</button>
      
      <div class="security-notice">
        ğŸ”’ Ù†Ø¸Ø§Ù… Ù…Ø¤Ù…Ù† | ÙŠÙ…Ù†Ø¹ Ø§Ù„Ù†Ø³Ø® ÙˆØ§Ù„ØºØ´
      </div>
    </div>
  </div>

  <!-- ØµÙØ­Ø© Ø§Ù„Ø±ÙØ¶ - Ø§Ù„ØªØ®ØµØµ ØºÙŠØ± Ù…Ø·Ø§Ø¨Ù‚ -->
  <div id="rejectMajorPage" class="page">
    <div class="result-card">
      <div class="result-icon">ğŸš«</div>
      <h2 class="result-title" style="color: var(--danger);">ØºÙŠØ± Ù…ØµØ±Ø­</h2>
      <p class="result-message">
        Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø®ØµØµ Ù„ØªØ®ØµØµ Ù…Ø¹ÙŠÙ†<br>
        ØªØ®ØµØµÙƒ ØºÙŠØ± Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª
      </p>
      <button class="btn-primary" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
    </div>
  </div>

  <!-- ØµÙØ­Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù†Ø¬Ø² -->
  <div id="alreadyDonePage" class="page">
    <div class="result-card">
      <div class="result-icon">âœ…</div>
      <h2 class="result-title" style="color: var(--success);">Ù„Ù‚Ø¯ Ø§Ø¬ØªØ²Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h2>
      <p class="result-message">
        Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨Ø¥Ø¬ØªÙŠØ§Ø² Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø³Ø¨Ù‚Ø§Ù‹<br>
        Ù†Ø³Ø¨ØªÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ©: <span id="currentGradeDisplay">0%</span>
      </p>
      <button class="btn-primary" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
    </div>
  </div>

  <!-- ØµÙØ­Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± -->
  <div id="quizPage" class="page">
    <div class="header">
      <div class="student-info">
        <h3 id="headerName">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</h3>
        <p id="headerId">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ</p>
      </div>
    </div>

    <div class="progress-bar">
      <div class="progress-header">
        <span>ØªÙ‚Ø¯Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</span>
        <span id="progressText">1 / 5</span>
      </div>
      <div class="progress-track">
        <div class="progress-fill" id="progressFill" style="width: 20%"></div>
      </div>
    </div>

    <div class="quiz-card">
      <span class="question-number" id="qNumber">Ø§Ù„Ø³Ø¤Ø§Ù„ 1</span>
      <h2 class="question-text" id="qText">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</h2>
      
      <div class="options" id="optionsContainer"></div>
    </div>

    <div class="nav-buttons">
      <button class="btn-nav btn-prev" id="prevBtn" onclick="prevQuestion()" style="display: none;">Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
      <button class="btn-nav btn-next" id="nextBtn" onclick="nextQuestion()">Ø§Ù„ØªØ§Ù„ÙŠ</button>
      <button class="btn-nav btn-submit" id="submitBtn" onclick="submitQuiz()" style="display: none;">Ø¥Ù†Ù‡Ø§Ø¡</button>
    </div>
  </div>

  <!-- ØµÙØ­Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
  <div id="resultPage" class="page">
    <div class="result-card" id="resultCard"></div>
  </div>

</div>

<!-- ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø®Ø±ÙˆØ¬ -->
<div id="exitWarning" class="exit-warning">
  <div class="exit-warning-icon">âš ï¸</div>
  <h2>ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±!</h2>
  <p>Ù„Ù‚Ø¯ ØºØ§Ø¯Ø±Øª Ø§Ù„Ù†Ø§ÙØ°Ø©. ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø¥Ø¬Ø§Ø¨Ø§ØªÙƒ.</p>
  <button class="btn-primary" onclick="logout()" style="margin-top: 20px;">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
</div>

<!-- Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ -->
<div id="modal" class="modal-overlay">
  <div class="modal-content">
    <div class="modal-icon" id="modalIcon">âš ï¸</div>
    <h3 class="modal-title" id="modalTitle">ØªÙ†Ø¨ÙŠÙ‡</h3>
    <p class="modal-text" id="modalText">Ø±Ø³Ø§Ù„Ø©</p>
    <div id="modalButtons">
      <button class="modal-btn modal-btn-confirm" id="modalConfirmBtn">ØªØ£ÙƒÙŠØ¯</button>
      <button class="modal-btn modal-btn-cancel" id="modalCancelBtn">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
  </div>
</div>

<!-- Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ -->
<div id="alert" class="alert"></div>

<script>
// ==========================================
// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase - Ø¹Ø¯Ù„Ù‡Ø§ Ø­Ø³Ø¨ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§ØªÙƒ
// ==========================================
const firebaseConfig = {
  apiKey: "AIzaSyAEXAMPLEnY", 
  authDomain: "store-points-7d2f4.firebaseapp.com",
  databaseURL: "https://store-points-7d2f4-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "store-points-7d2f4",
  storageBucket: "store-points-7d2f4.appspot.com",
  messagingSenderId: "105011111111",
  appId: "1:105011111111:web:abc123example"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ==========================================
// Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
// ==========================================
let currentStudent = null;
let currentQuestion = 0;
let answers = {};
let quizSubmitted = false;

// ==========================================
// Ø§Ù„Ø£Ø³Ø¦Ù„Ø© - 3 Ø®ÙŠØ§Ø±Ø§Øª Ù„ÙƒÙ„ Ø³Ø¤Ø§Ù„
// ==========================================
const quizQuestions = [
  {
    question: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¬Ø±Ø§ÙÙŠÙƒÙŠØŸ",
    options: [
      "ÙÙ† ØªÙˆØ§ØµÙ„ Ø¨ØµØ±ÙŠ",      // 0 - ØµØ­
      "Ù†ÙˆØ¹ Ù…Ù† Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©",      // 1
      "Ù„ØºØ© Ø¨Ø±Ù…Ø¬Ø©"            // 2
    ],
    correct: 0
  },
  {
    question: "Ø£ÙŠ Ù…Ù† Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„ØªØ§Ù„ÙŠØ© Ù‡Ùˆ Ù„ÙˆÙ† Ø£Ø³Ø§Ø³ÙŠØŸ",
    options: [
      "Ø§Ù„Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ",           // 0
      "Ø§Ù„Ø£Ø­Ù…Ø±",              // 1 - ØµØ­
      "Ø§Ù„Ø£Ø®Ø¶Ø±"               // 2
    ],
    correct: 1
  },
  {
    question: "Ù…Ø§ Ù‡ÙŠ Ø¯Ù‚Ø© Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©ØŸ",
    options: [
      "72 DPI",              // 0
      "150 DPI",             // 1
      "300 DPI"              // 2 - ØµØ­
    ],
    correct: 2
  },
  {
    question: "Ø£ÙŠ Ø¨Ø±Ù†Ø§Ù…Ø¬ ÙŠØ³ØªØ®Ø¯Ù… Ù„Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…ØªØ¬Ù‡ÙŠØŸ",
    options: [
      "ÙÙˆØªÙˆØ´ÙˆØ¨",             // 0
      "Ø§Ù„Ø³ØªØ±ÙŠØªÙˆØ±",           // 1 - ØµØ­
      "Ø¨ÙˆØ±Ø¨ÙˆÙŠÙ†Øª"             // 2
    ],
    correct: 1
  },
  {
    question: "Ù…Ø§ Ù‡Ùˆ RGBØŸ",
    options: [
      "Ù†Ø¸Ø§Ù… Ø£Ù„ÙˆØ§Ù† Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©",  // 0
      "Ù†Ø¸Ø§Ù… Ø£Ù„ÙˆØ§Ù† Ù„Ù„Ø´Ø§Ø´Ø§Øª",  // 1 - ØµØ­
      "Ù†ÙˆØ¹ Ù…Ù† Ø§Ù„Ù…Ù„ÙØ§Øª"       // 2
    ],
    correct: 1
  }
];

// ==========================================
// ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„ØªØ­Ù‚Ù‚
// ==========================================
async function handleLogin() {
  const id = document.getElementById('loginId').value.trim();
  const pass = document.getElementById('loginPass').value.trim();
  
  if (!id || !pass) {
    showAlert('âš ï¸ Ø£Ø¯Ø®Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
    return;
  }
  
  try {
    // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨
    const snapshot = await db.ref('users/' + id).once('value');
    const student = snapshot.val();
    
    if (!student) {
      showAlert('âŒ Ø§Ù„Ø±Ù‚Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
      return;
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
    if (student.password !== pass && student.id !== pass) {
      showAlert('âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø·Ø£', 'error');
      return;
    }
    
    currentStudent = { id, ...student };
    
    // ==========================================
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ®ØµØµ (Ø¹Ø¯Ù„ Ù‡Ù†Ø§ Ø§Ù„ØªØ®ØµØµ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨)
    // ==========================================
    const allowedMajor = "Ø¬Ø±Ø§ÙÙŠÙƒØ³ Ø§Ù„Ø¬ÙˆØ§Ù„"; // â† ØºÙŠØ± Ø§Ù„ØªØ®ØµØµ Ù‡Ù†Ø§
    const studentMajor = (student.major || '').trim();
    
    if (studentMajor !== allowedMajor) {
      showPage('rejectMajorPage');
      return;
    }
    
    // ==========================================
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù†Ø³Ø¨Ø© (Ù‡Ù„ Ø§Ø¬ØªØ§Ø² Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø³Ø¨Ù‚Ø§Ù‹ØŸ)
    // ==========================================
    const currentGrade = parseInt(student.grade) || 0;
    
    if (currentGrade >= 10) {
      // Ø§Ø¬ØªØ§Ø² Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø³Ø¨Ù‚Ø§Ù‹
      document.getElementById('currentGradeDisplay').textContent = student.grade || '10%';
      showPage('alreadyDonePage');
      return;
    }
    
    // ==========================================
    // Ø§Ù„Ù†Ø³Ø¨Ø© 0% - Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
    // ==========================================
    startQuiz();
    
  } catch (error) {
    console.error(error);
    showAlert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„', 'error');
  }
}

// ==========================================
// Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
// ==========================================
function startQuiz() {
  showPage('quizPage');
  
  document.getElementById('headerName').textContent = currentStudent.name;
  document.getElementById('headerId').textContent = currentStudent.id;
  
  currentQuestion = 0;
  answers = {};
  quizSubmitted = false;
  
  // Ù…Ù†Ø¹ Ø§Ù„Ø®Ø±ÙˆØ¬
  preventExit();
  
  renderQuestion();
}

// ==========================================
// Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„
// ==========================================
function renderQuestion() {
  const q = quizQuestions[currentQuestion];
  
  document.getElementById('qNumber').textContent = `Ø§Ù„Ø³Ø¤Ø§Ù„ ${currentQuestion + 1} Ù…Ù† ${quizQuestions.length}`;
  document.getElementById('qText').textContent = q.question;
  
  // Ø§Ù„ØªÙ‚Ø¯Ù…
  const progress = ((currentQuestion + 1) / quizQuestions.length) * 100;
  document.getElementById('progressFill').style.width = progress + '%';
  document.getElementById('progressText').textContent = `${currentQuestion + 1} / ${quizQuestions.length}`;
  
  // Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª (3 Ø®ÙŠØ§Ø±Ø§Øª)
  const container = document.getElementById('optionsContainer');
  container.innerHTML = '';
  
  const letters = ['Ø£', 'Ø¨', 'Ø¬']; // 3 Ø­Ø±ÙˆÙ ÙÙ‚Ø·
  
  q.options.forEach((opt, idx) => {
    const div = document.createElement('div');
    div.className = 'option';
    if (answers[currentQuestion] === idx) div.classList.add('selected');
    
    div.innerHTML = `
      <div class="option-letter">${letters[idx]}</div>
      <div>${opt}</div>
    `;
    
    div.onclick = () => {
      answers[currentQuestion] = idx;
      renderQuestion();
    };
    
    container.appendChild(div);
  });
  
  // Ø§Ù„Ø£Ø²Ø±Ø§Ø±
  document.getElementById('prevBtn').style.display = currentQuestion > 0 ? 'block' : 'none';
  
  if (currentQuestion === quizQuestions.length - 1) {
    document.getElementById('nextBtn').style.display = 'none';
    document.getElementById('submitBtn').style.display = 'block';
  } else {
    document.getElementById('nextBtn').style.display = 'block';
    document.getElementById('submitBtn').style.display = 'none';
  }
}

// ==========================================
// Ø§Ù„ØªÙ†Ù‚Ù„
// ==========================================
function nextQuestion() {
  if (answers[currentQuestion] === undefined) {
    showAlert('âš ï¸ Ø§Ø®ØªØ± Ø¥Ø¬Ø§Ø¨Ø©', 'error');
    return;
  }
  currentQuestion++;
  renderQuestion();
}

function prevQuestion() {
  currentQuestion--;
  renderQuestion();
}

// ==========================================
// Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
// ==========================================
async function submitQuiz() {
  if (answers[currentQuestion] === undefined) {
    showAlert('âš ï¸ Ø§Ø®ØªØ± Ø¥Ø¬Ø§Ø¨Ø©', 'error');
    return;
  }
  
  const confirmed = await showModal('ğŸ“', 'ØªØ£ÙƒÙŠØ¯', 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±ØŸ');
  if (!confirmed) return;
  
  quizSubmitted = true;
  checkResults();
}

// ==========================================
// ÙØ­Øµ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
// ==========================================
async function checkResults() {
  let wrongCount = 0;
  
  quizQuestions.forEach((q, idx) => {
    if (answers[idx] !== q.correct) wrongCount++;
  });
  
  const allCorrect = wrongCount === 0;
  
  showResults(wrongCount, allCorrect);
  
  // Ø¥Ø°Ø§ ÙƒÙ„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª ØµØ­ÙŠØ­Ø© â†’ Ø±ÙØ¹ Ø§Ù„Ù†Ø³Ø¨Ø©
  if (allCorrect) {
    await updateGrade();
  }
}

// ==========================================
// Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
// ==========================================
function showResults(wrongCount, allCorrect) {
  showPage('resultPage');
  
  const card = document.getElementById('resultCard');
  
  if (allCorrect) {
    // Ù†Ø¬Ø§Ø­ ÙƒØ§Ù…Ù„
    card.innerHTML = `
      <div class="result-icon">ğŸ‰</div>
      <h2 class="result-title" style="color: var(--success);">Ù…Ø¨Ø±ÙˆÙƒ! Ù†Ø¬Ø§Ø­ ÙƒØ§Ù…Ù„</h2>
      <p class="result-message">
        Ø£Ø¬Ø¨Øª Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
      </p>
      <div class="success-box" id="successBox">
        <div class="success-text">ğŸŒŸ Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ù†Ø³Ø¨ØªÙƒ...</div>
      </div>
    `;
  } else {
    // ÙØ´Ù„ - ÙŠØ¸Ù‡Ø± Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ÙÙ‚Ø·
    card.innerHTML = `
      <div class="result-icon">ğŸ˜”</div>
      <h2 class="result-title" style="color: var(--danger);">Ù„Ù… ØªÙ†Ø¬Ø­</h2>
      <p class="result-message">
        Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡: <strong>${wrongCount}</strong> Ø£Ø®Ø·Ø§Ø¡<br>
        ÙŠØ¬Ø¨ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
      </p>
      <button class="btn-primary" onclick="logout()">Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</button>
    `;
  }
}

// ==========================================
// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø³Ø¨Ø© ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
// ==========================================
async function updateGrade() {
  try {
    const newGrade = 10; // Ù†Ø³Ø¨Ø© Ø«Ø§Ø¨ØªØ© 10%
    
    await db.ref('users/' + currentStudent.id).update({
      grade: newGrade + '%',
      quizCompletedAt: new Date().toISOString(),
      updatedAt: new Date().toISOString()
    });
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    const box = document.getElementById('successBox');
    if (box) {
      box.innerHTML = `
        <div class="success-text">âœ… ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! Ù„Ù‚Ø¯ Ø§Ø±ØªÙØ¹Øª Ù†Ø³Ø¨ØªÙƒ</div>
        <div style="margin-top: 10px; font-size: 1.3rem;">Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: 10%</div>
      `;
    }
    
    // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„Ø®Ø±ÙˆØ¬
    const card = document.getElementById('resultCard');
    const btn = document.createElement('button');
    btn.className = 'btn-primary';
    btn.style.marginTop = '20px';
    btn.textContent = 'Ø®Ø±ÙˆØ¬';
    btn.onclick = logout;
    card.appendChild(btn);
    
    showAlert('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ù†Ø³Ø¨ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
    
  } catch (error) {
    console.error(error);
    showAlert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«', 'error');
  }
}

// ==========================================
// Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©
// ==========================================
function showPage(pageId) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(pageId).classList.add('active');
}

function showModal(icon, title, text) {
  return new Promise(resolve => {
    document.getElementById('modalIcon').textContent = icon;
    document.getElementById('modalTitle').textContent = title;
    document.getElementById('modalText').textContent = text;
    
    const confirmBtn = document.getElementById('modalConfirmBtn');
    const cancelBtn = document.getElementById('modalCancelBtn');
    
    confirmBtn.onclick = () => {
      closeModal();
      resolve(true);
    };
    
    cancelBtn.onclick = () => {
      closeModal();
      resolve(false);
    };
    
    document.getElementById('modal').classList.add('active');
  });
}

function closeModal() {
  document.getElementById('modal').classList.remove('active');
}

function showAlert(text, type) {
  const alert = document.getElementById('alert');
  alert.textContent = text;
  alert.className = 'alert show ' + type;
  setTimeout(() => alert.classList.remove('show'), 3000);
}

function logout() {
  location.reload();
}

// ==========================================
// Ù…Ù†Ø¹ Ø§Ù„Ø®Ø±ÙˆØ¬ ÙˆØ§Ù„ØºØ´
// ==========================================
function preventExit() {
  // Ù…Ù†Ø¹ Ø§Ù„Ø±Ø¬ÙˆØ¹
  history.pushState(null, null, location.href);
  window.addEventListener('popstate', () => {
    history.pushState(null, null, location.href);
    if (!quizSubmitted) showExitWarning();
  });
  
  // ÙƒØ´Ù ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨
  document.addEventListener('visibilitychange', () => {
    if (document.hidden && !quizSubmitted) {
      showExitWarning();
    }
  });
  
  // Ù…Ù†Ø¹ Ø§Ù„Ù†Ø³Ø®
  document.addEventListener('copy', e => {
    e.preventDefault();
    showAlert('â›” Ø§Ù„Ù†Ø³Ø® Ù…Ù…Ù†ÙˆØ¹!', 'error');
  });
  
  document.addEventListener('paste', e => {
    e.preventDefault();
    showAlert('â›” Ø§Ù„Ù„ØµÙ‚ Ù…Ù…Ù†ÙˆØ¹!', 'error');
  });
  
  document.addEventListener('contextmenu', e => e.preventDefault());
}

function showExitWarning() {
  document.getElementById('exitWarning').classList.add('active');
  quizSubmitted = true;
}

// Ù…Ù†Ø¹ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø©
window.addEventListener('beforeunload', e => {
  if (!quizSubmitted && document.getElementById('quizPage').classList.contains('active')) {
    e.returnValue = 'Ø³ØªÙÙ‚Ø¯ ØªÙ‚Ø¯Ù…Ùƒ!';
  }
});
</script>

</body>
</html>
