<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…ØªØ¬Ø± Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --primary: #2563eb;
  --primary-hover: #1d4ed8;
  --secondary: #f59e0b;
  --success: #10b981;
  --danger: #ef4444;
  --bg: #f8fafc;
  --card-bg: #ffffff;
  --text: #0f172a;
  --text-light: #64748b;
  --border: #e2e8f0;
  --shadow: 0 1px 3px rgba(0,0,0,0.1);
  --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
}

body { 
  font-family: 'Cairo', sans-serif; 
  background: var(--bg);
  min-height: 100vh;
  color: var(--text);
  line-height: 1.5;
  font-size: 14px;
}

/* Login Modal */
.login-modal {
  display: flex;
  position: fixed;
  inset: 0;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  z-index: 5000;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

.login-content {
  background: white;
  border-radius: 24px;
  max-width: 420px;
  width: 100%;
  padding: 40px;
  text-align: center;
  box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
}

.login-logo {
  width: 80px;
  height: 80px;
  background: var(--primary);
  border-radius: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 24px;
  color: white;
  font-size: 2.5rem;
}

.login-title {
  font-size: 1.75rem;
  font-weight: 800;
  margin-bottom: 8px;
  color: var(--text);
}

.login-subtitle {
  color: var(--text-light);
  margin-bottom: 32px;
  font-size: 1rem;
}

.login-input-group {
  margin-bottom: 20px;
  text-align: right;
}

.login-input-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 700;
  color: var(--text);
  font-size: 0.9rem;
}

.login-input-group input {
  width: 100%;
  padding: 16px;
  border: 2px solid var(--border);
  border-radius: 12px;
  font-size: 1rem;
  text-align: center;
  font-family: inherit;
  transition: all 0.3s;
}

.login-input-group input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
}

.login-btn {
  width: 100%;
  background: var(--primary);
  color: white;
  border: none;
  padding: 16px;
  border-radius: 12px;
  font-size: 1.1rem;
  font-weight: 700;
  cursor: pointer;
  margin-top: 8px;
  transition: all 0.3s;
}

.login-btn:hover {
  background: var(--primary-hover);
  transform: translateY(-2px);
  box-shadow: 0 10px 20px rgba(37, 99, 235, 0.3);
}

.login-error {
  color: var(--danger);
  margin-top: 16px;
  font-weight: 600;
  display: none;
}

.login-error.show {
  display: block;
  animation: shake 0.5s;
}

/* Header - Compact */
.store-header {
  background: var(--card-bg);
  border-bottom: 1px solid var(--border);
  padding: 10px 0;
  position: sticky;
  top: 0;
  z-index: 100;
  box-shadow: var(--shadow);
}

.header-content {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 16px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.logo {
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
}

.logo-icon {
  width: 36px;
  height: 36px;
  background: var(--primary);
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 1.1rem;
}

.logo-text {
  font-size: 1.2rem;
  font-weight: 800;
  color: var(--text);
}

/* Small Points Display */
.user-points-mini {
  background: linear-gradient(135deg, var(--secondary), #d97706);
  color: white;
  padding: 4px 10px;
  border-radius: 12px;
  font-weight: 700;
  font-size: 0.75rem;
  display: flex;
  align-items: center;
  gap: 4px;
}

.header-actions {
  display: flex;
  gap: 6px;
}

.icon-btn {
  width: 36px;
  height: 36px;
  border-radius: 8px;
  border: none;
  background: var(--bg);
  color: var(--text);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1rem;
  position: relative;
  transition: all 0.2s;
}

.icon-btn:hover {
  background: var(--primary);
  color: white;
}

.badge {
  position: absolute;
  top: -2px;
  right: -2px;
  background: var(--danger);
  color: white;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  font-size: 0.65rem;
  font-weight: 700;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Top Stats Section */
.top-stats-section {
  background: white;
  padding: 16px 0;
  border-bottom: 1px solid var(--border);
}

.stats-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 16px;
  display: flex;
  gap: 12px;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

.stat-card {
  flex: 0 0 auto;
  background: linear-gradient(135deg, var(--primary), #3b82f6);
  color: white;
  padding: 12px 20px;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  gap: 10px;
  min-width: 160px;
}

.stat-card:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}

.stat-card.rated {
  background: linear-gradient(135deg, var(--secondary), #d97706);
}

.stat-icon {
  font-size: 1.5rem;
}

.stat-info {
  display: flex;
  flex-direction: column;
}

.stat-title {
  font-size: 0.8rem;
  opacity: 0.9;
}

.stat-subtitle {
  font-size: 0.7rem;
  opacity: 0.8;
}

/* Categories */
.categories-nav {
  background: white;
  padding: 10px 0;
  border-bottom: 1px solid var(--border);
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

.categories-list {
  display: flex;
  gap: 8px;
  padding: 0 16px;
  max-width: 1200px;
  margin: 0 auto;
  list-style: none;
}

.category-item {
  white-space: nowrap;
}

.category-btn {
  padding: 8px 16px;
  border: 1px solid var(--border);
  background: white;
  border-radius: 20px;
  font-family: inherit;
  font-size: 0.85rem;
  font-weight: 600;
  color: var(--text);
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  gap: 6px;
}

.category-btn:hover, .category-btn.active {
  background: var(--primary);
  color: white;
  border-color: var(--primary);
}

/* Main Container */
.store-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px 16px;
}

/* Section Header */
.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
  margin-top: 28px;
}

.section-header:first-child {
  margin-top: 0;
}

.section-title {
  font-size: 1.1rem;
  font-weight: 800;
  color: var(--text);
  display: flex;
  align-items: center;
  gap: 8px;
}

.view-all-btn {
  color: var(--primary);
  font-size: 0.85rem;
  font-weight: 700;
  text-decoration: none;
  display: flex;
  align-items: center;
  gap: 4px;
  cursor: pointer;
  background: none;
  border: none;
  font-family: inherit;
  padding: 6px 12px;
  border-radius: 8px;
  transition: all 0.2s;
}

.view-all-btn:hover {
  background: #eff6ff;
}

/* Scroll Container */
.scroll-container {
  position: relative;
  margin-bottom: 32px;
}

.scroll-wrapper {
  overflow-x: auto;
  overflow-y: hidden;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
  -ms-overflow-style: none;
  padding-bottom: 8px;
}

.scroll-wrapper::-webkit-scrollbar {
  display: none;
}

.products-scroll {
  display: flex;
  gap: 12px;
  padding: 4px;
}

/* Product Card */
.product-card {
  background: var(--card-bg);
  border-radius: 12px;
  overflow: hidden;
  border: 1px solid var(--border);
  transition: all 0.3s ease;
  flex: 0 0 160px;
  cursor: pointer;
  position: relative;
}

.product-card:hover {
  box-shadow: var(--shadow-md);
  transform: translateY(-4px);
}

.product-image-wrapper {
  position: relative;
  height: 160px;
  background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
  overflow: hidden;
}

.product-image {
  width: 100%;
  height: 100%;
  object-fit: contain;
  padding: 10px;
  transition: transform 0.4s ease;
}

.product-card:hover .product-image {
  transform: scale(1.08);
}

.discount-badge {
  position: absolute;
  top: 8px;
  left: 8px;
  background: var(--danger);
  color: white;
  padding: 3px 8px;
  border-radius: 10px;
  font-size: 0.7rem;
  font-weight: 800;
}

.sales-badge {
  position: absolute;
  bottom: 8px;
  left: 8px;
  background: rgba(0,0,0,0.7);
  color: white;
  padding: 3px 6px;
  border-radius: 6px;
  font-size: 0.65rem;
  font-weight: 600;
}

.rating-badge {
  position: absolute;
  top: 8px;
  right: 8px;
  background: rgba(255,255,255,0.95);
  color: var(--secondary);
  padding: 3px 8px;
  border-radius: 10px;
  font-size: 0.75rem;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 4px;
}

.wishlist-btn {
  position: absolute;
  bottom: 8px;
  right: 8px;
  width: 28px;
  height: 28px;
  border-radius: 50%;
  border: none;
  background: rgba(255,255,255,0.95);
  color: var(--text-light);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.8rem;
  transition: all 0.2s;
  z-index: 5;
}

.wishlist-btn:hover, .wishlist-btn.active {
  background: var(--danger);
  color: white;
  transform: scale(1.1);
}

.card-content {
  padding: 10px;
}

.product-title {
  font-size: 0.8rem;
  font-weight: 700;
  color: var(--text);
  margin-bottom: 6px;
  height: 36px;
  overflow: hidden;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  line-height: 1.4;
}

.price-row {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 4px;
}

.current-price {
  font-size: 1rem;
  font-weight: 800;
  color: var(--primary);
}

.original-price {
  font-size: 0.75rem;
  color: var(--text-light);
  text-decoration: line-through;
}

.rating {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: 0.75rem;
  color: var(--secondary);
}

.add-cart-btn {
  width: 100%;
  background: var(--primary);
  color: white;
  border: none;
  padding: 8px;
  border-radius: 6px;
  font-size: 0.8rem;
  font-weight: 700;
  cursor: pointer;
  margin-top: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 4px;
  transition: all 0.2s;
}

.add-cart-btn:hover {
  background: var(--primary-hover);
}

.add-cart-btn.added {
  background: var(--success);
}

/* Grid View */
.products-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
}

.products-grid .product-card {
  flex: none;
}

.products-grid .product-image-wrapper {
  height: 180px;
}

/* Page Container */
.page-container {
  background: white;
  border-radius: 16px;
  padding: 20px;
  min-height: 60vh;
}

.page-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 12px;
  border-bottom: 2px solid var(--border);
}

.page-title {
  font-size: 1.3rem;
  font-weight: 800;
  display: flex;
  align-items: center;
  gap: 10px;
}

.back-btn {
  background: var(--bg);
  border: none;
  padding: 8px 16px;
  border-radius: 8px;
  font-family: inherit;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 0.85rem;
  transition: all 0.2s;
}

.back-btn:hover {
  background: var(--border);
}

/* Cart Item */
.cart-item {
  display: flex;
  gap: 12px;
  padding: 12px;
  border: 1px solid var(--border);
  border-radius: 10px;
  margin-bottom: 10px;
  background: var(--bg);
  transition: all 0.2s;
}

.cart-item:hover {
  border-color: var(--primary);
}

.cart-item-image {
  width: 80px;
  height: 80px;
  object-fit: contain;
  background: white;
  border-radius: 8px;
  padding: 6px;
}

.cart-item-details {
  flex: 1;
}

.cart-item-title {
  font-weight: 700;
  margin-bottom: 6px;
  font-size: 0.9rem;
}

.cart-item-price {
  color: var(--primary);
  font-weight: 800;
  font-size: 1rem;
  margin-bottom: 8px;
}

.cart-item-actions {
  display: flex;
  gap: 10px;
  align-items: center;
}

.quantity-control {
  display: flex;
  align-items: center;
  gap: 6px;
  background: white;
  border-radius: 6px;
  padding: 2px;
  border: 1px solid var(--border);
}

.qty-btn {
  width: 28px;
  height: 28px;
  border: none;
  background: var(--bg);
  border-radius: 4px;
  cursor: pointer;
  font-weight: 700;
  font-size: 1rem;
  transition: all 0.2s;
}

.qty-btn:hover {
  background: var(--primary);
  color: white;
}

.qty-value {
  font-weight: 700;
  min-width: 24px;
  text-align: center;
  font-size: 0.9rem;
}

.remove-btn {
  background: var(--danger);
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  font-size: 0.75rem;
  display: flex;
  align-items: center;
  gap: 4px;
}

/* Cart Summary */
.cart-summary {
  background: var(--bg);
  border-radius: 12px;
  padding: 16px;
  margin-top: 20px;
  position: sticky;
  bottom: 16px;
  box-shadow: var(--shadow-md);
}

.summary-row {
  display: flex;
  justify-content: space-between;
  margin-bottom: 8px;
  font-size: 0.9rem;
}

.summary-row.total {
  font-size: 1.1rem;
  font-weight: 800;
  color: var(--primary);
  padding-top: 8px;
  border-top: 2px solid var(--border);
  margin-top: 8px;
}

.checkout-btn {
  width: 100%;
  background: var(--success);
  color: white;
  border: none;
  padding: 12px;
  border-radius: 10px;
  font-size: 1rem;
  font-weight: 800;
  cursor: pointer;
  margin-top: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  transition: all 0.3s;
}

.checkout-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 16px rgba(16, 185, 129, 0.3);
}

/* Rating Modal */
.rating-modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  z-index: 3000;
  align-items: center;
  justify-content: center;
  padding: 16px;
}

.rating-modal.show {
  display: flex;
}

.rating-content {
  background: white;
  border-radius: 20px;
  max-width: 400px;
  width: 100%;
  padding: 28px;
  text-align: center;
  animation: slideUp 0.3s ease;
}

.rating-title {
  font-size: 1.2rem;
  font-weight: 800;
  margin-bottom: 8px;
}

.rating-subtitle {
  color: var(--text-light);
  font-size: 0.9rem;
  margin-bottom: 20px;
}

.stars-container {
  display: flex;
  justify-content: center;
  gap: 8px;
  margin-bottom: 20px;
}

.star-btn {
  background: none;
  border: none;
  font-size: 2rem;
  color: #e2e8f0;
  cursor: pointer;
  transition: all 0.2s;
}

.star-btn:hover, .star-btn.active {
  color: var(--secondary);
  transform: scale(1.2);
}

.rating-actions {
  display: flex;
  gap: 10px;
}

.rating-actions button {
  flex: 1;
  padding: 12px;
  border-radius: 10px;
  font-weight: 700;
  cursor: pointer;
  border: none;
}

.submit-rating {
  background: var(--primary);
  color: white;
}

.cancel-rating {
  background: var(--bg);
  color: var(--text);
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: 50px 20px;
  color: var(--text-light);
}

.empty-state i {
  font-size: 3.5rem;
  margin-bottom: 16px;
  opacity: 0.3;
}

.empty-state h3 {
  font-size: 1.2rem;
  margin-bottom: 6px;
  color: var(--text);
}

/* Product Detail Modal */
.detail-modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  z-index: 1500;
  overflow-y: auto;
}

.detail-modal.show {
  display: block;
}

.detail-content {
  background: white;
  max-width: 600px;
  margin: 0 auto;
  min-height: 100vh;
  position: relative;
}

.detail-header {
  position: sticky;
  top: 0;
  background: white;
  padding: 12px 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid var(--border);
  z-index: 10;
}

.detail-image-section {
  position: relative;
  height: 350px;
  background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
}

.detail-image {
  width: 100%;
  height: 100%;
  object-fit: contain;
  padding: 20px;
}

.image-dots {
  position: absolute;
  bottom: 16px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 6px;
}

.dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: rgba(255,255,255,0.5);
  cursor: pointer;
  transition: all 0.2s;
}

.dot.active {
  background: white;
  width: 20px;
  border-radius: 4px;
}

.expand-image-btn {
  position: absolute;
  bottom: 16px;
  right: 16px;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: rgba(255,255,255,0.95);
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.1rem;
}

.gallery-nav {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(255,255,255,0.9);
  border: none;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  cursor: pointer;
  font-size: 1.2rem;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
}

.gallery-nav:hover {
  background: white;
}

.gallery-prev { right: 16px; }
.gallery-next { left: 16px; }

.detail-info {
  padding: 20px;
}

.detail-title {
  font-size: 1.3rem;
  font-weight: 800;
  margin-bottom: 12px;
}

.detail-price-section {
  display: flex;
  align-items: baseline;
  gap: 12px;
  margin-bottom: 16px;
  flex-wrap: wrap;
}

.detail-current-price {
  font-size: 1.8rem;
  font-weight: 800;
  color: var(--primary);
}

.detail-original-price {
  font-size: 1.1rem;
  color: var(--text-light);
  text-decoration: line-through;
}

.detail-discount {
  background: var(--danger);
  color: white;
  padding: 4px 12px;
  border-radius: 16px;
  font-size: 0.85rem;
  font-weight: 700;
}

.detail-rating {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  margin-bottom: 20px;
  padding: 12px;
  background: var(--bg);
  border-radius: 12px;
}

.rate-btn {
  background: white;
  border: 1px solid var(--border);
  padding: 8px 16px;
  border-radius: 20px;
  font-family: inherit;
  font-weight: 600;
  font-size: 0.85rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 6px;
  transition: all 0.2s;
  margin-right: auto;
}

.rate-btn:hover {
  background: var(--primary);
  color: white;
  border-color: var(--primary);
}

.detail-stats {
  display: flex;
  gap: 24px;
  padding: 16px 0;
  border-top: 1px solid var(--border);
  border-bottom: 1px solid var(--border);
  margin-bottom: 20px;
}

.stat {
  text-align: center;
  flex: 1;
}

.stat-value {
  font-size: 1.2rem;
  font-weight: 800;
  color: var(--text);
  display: block;
}

.stat-label {
  font-size: 0.8rem;
  color: var(--text-light);
  margin-top: 2px;
}

.detail-description {
  margin-bottom: 100px;
}

.detail-description h3 {
  font-size: 1rem;
  font-weight: 700;
  margin-bottom: 10px;
}

.detail-description p {
  color: var(--text-light);
  line-height: 1.7;
  font-size: 0.9rem;
}

.detail-actions {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: white;
  padding: 16px;
  border-top: 1px solid var(--border);
  display: flex;
  gap: 10px;
  box-shadow: 0 -4px 6px -1px rgba(0,0,0,0.1);
}

.add-to-cart-btn, .buy-now-btn {
  flex: 1;
  padding: 14px;
  border-radius: 10px;
  font-size: 0.95rem;
  font-weight: 700;
  cursor: pointer;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  transition: all 0.3s;
}

.add-to-cart-btn {
  background: var(--primary);
  color: white;
}

.add-to-cart-btn:hover {
  background: var(--primary-hover);
}

.buy-now-btn {
  background: var(--success);
  color: white;
}

.buy-now-btn:hover {
  background: #059669;
}

/* Gallery Modal */
.gallery-modal {
  display: none;
  position: fixed;
  inset: 0;
  background: #000;
  z-index: 2000;
  flex-direction: column;
}

.gallery-modal.show {
  display: flex;
}

.gallery-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 20px;
  background: rgba(0,0,0,0.8);
  color: white;
}

.gallery-title {
  font-size: 1rem;
  font-weight: 600;
}

.gallery-close {
  background: none;
  border: none;
  color: white;
  font-size: 1.5rem;
  cursor: pointer;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.gallery-main {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  padding: 20px;
}

.gallery-image {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
}

.gallery-counter {
  position: absolute;
  bottom: 90px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0,0,0,0.6);
  color: white;
  padding: 8px 20px;
  border-radius: 20px;
  font-size: 0.9rem;
}

.gallery-nav {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(255,255,255,0.2);
  border: none;
  color: white;
  width: 45px;
  height: 45px;
  border-radius: 50%;
  cursor: pointer;
  font-size: 1.2rem;
  display: flex;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(4px);
}

.gallery-nav:hover {
  background: rgba(255,255,255,0.3);
}

.gallery-prev { right: 20px; }
.gallery-next { left: 20px; }

.gallery-thumbnails {
  display: flex;
  gap: 10px;
  padding: 16px 20px;
  overflow-x: auto;
  background: rgba(0,0,0,0.8);
}

.thumbnail {
  width: 60px;
  height: 60px;
  border-radius: 8px;
  overflow: hidden;
  cursor: pointer;
  border: 2px solid transparent;
  opacity: 0.6;
  transition: all 0.2s;
  flex-shrink: 0;
}

.thumbnail.active {
  border-color: var(--primary);
  opacity: 1;
}

.thumbnail img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* Loading */
.loading {
  text-align: center;
  padding: 50px 20px;
  color: var(--text-light);
}

.spinner {
  width: 40px;
  height: 40px;
  border: 3px solid var(--border);
  border-top-color: var(--primary);
  border-radius: 50%;
  margin: 0 auto 12px;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-10px); }
  75% { transform: translateX(10px); }
}

@keyframes slideUp {
  from { transform: translateY(20px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

/* Responsive */
@media (min-width: 768px) {
  .product-card {
    flex: 0 0 200px;
  }
  
  .product-image-wrapper {
    height: 200px;
  }
  
  .products-grid {
    grid-template-columns: repeat(3, 1fr);
  }
}

@media (min-width: 1024px) {
  .products-grid {
    grid-template-columns: repeat(4, 1fr);
  }
  
  .product-card {
    flex: 0 0 220px;
  }
}
</style>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyByR2B-XISUw_PYh5EeIcbNQwwII0c6xZg",
  authDomain: "store-points-7d2f4.firebaseapp.com",
  databaseURL: "https://store-points-7d2f4-default-rtdb.asia-southeast1.firebasedatabase.app/",
  projectId: "store-points-7d2f4",
  storageBucket: "store-points-7d2f4.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const database = firebase.database();

// Global Variables
let currentUser = null;
let currentUserCode = null;
let users = {};
let products = {};
let globalSales = {};
let productRatings = {};
let currentProduct = null;
let currentImages = [];
let currentImageIndex = 0;
let cart = {};
let wishlist = {};
let currentRating = 0;

// Categories
const categories = [
  { id: 'all', name: 'Ø§Ù„ÙƒÙ„', icon: 'fa-th-large' },
  { id: 'apps', name: 'ØªØ·Ø¨ÙŠÙ‚Ø§Øª ÙˆØ¨Ø±Ø§Ù…Ø¬', icon: 'fa-mobile-alt' },
  { id: 'fonts', name: 'Ø®Ø·ÙˆØ·', icon: 'fa-font' },
  { id: 'projects', name: 'Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¨ÙŠÙƒØ³Ù„Ø§Ø¨', icon: 'fa-layer-group' }
];

window.onload = () => {
  checkLoginStatus();
};

function checkLoginStatus() {
  const savedUser = localStorage.getItem('academyUser');
  if (savedUser) {
    const userData = JSON.parse(savedUser);
    currentUserCode = userData.code;
    loadUserData(userData.code);
  } else {
    showLoginModal();
  }
}

function showLoginModal() {
  document.getElementById('loginModal').style.display = 'flex';
}

function hideLoginModal() {
  document.getElementById('loginModal').style.display = 'none';
}

function login() {
  const code = document.getElementById('loginCode').value.trim();
  const pass = document.getElementById('loginPass').value.trim();
  const errorEl = document.getElementById('loginError');
  
  if (!code || !pass) {
    errorEl.textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
    errorEl.classList.add('show');
    return;
  }
  
  database.ref(`users/${code}`).once('value').then(snapshot => {
    const user = snapshot.val();
    if (!user) {
      errorEl.textContent = 'Ø§Ù„Ø±Ù‚Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯';
      errorEl.classList.add('show');
      return;
    }
    
    if (user.password !== pass) {
      errorEl.textContent = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
      errorEl.classList.add('show');
      return;
    }
    
    currentUserCode = code;
    currentUser = user;
    localStorage.setItem('academyUser', JSON.stringify({ code: code, name: user.name }));
    
    loadUserData(code);
    hideLoginModal();
  });
}

function loadUserData(code) {
  Promise.all([
    database.ref('users').once('value'),
    database.ref('products').once('value'),
    database.ref('globalSales').once('value'),
    database.ref('productRatings').once('value'),
    database.ref(`userCarts/${code}`).once('value'),
    database.ref(`userWishlists/${code}`).once('value')
  ]).then(([usersSnap, productsSnap, salesSnap, ratingsSnap, cartSnap, wishlistSnap]) => {
    users = usersSnap.val() || {};
    products = productsSnap.val() || {};
    globalSales = salesSnap.val() || {};
    productRatings = ratingsSnap.val() || {};
    cart = cartSnap.val() || {};
    wishlist = wishlistSnap.val() || {};
    currentUser = users[code];
    
    calculateProductRatings();
    updateHeader();
    renderTopStats();
    renderCategories();
    renderHomeSections();
  });
}

function calculateProductRatings() {
  for (let pid in products) {
    const ratings = productRatings[pid];
    if (ratings) {
      const values = Object.values(ratings);
      const avg = values.reduce((a, b) => a + b, 0) / values.length;
      products[pid].avgRating = avg.toFixed(1);
      products[pid].ratingCount = values.length;
    } else {
      products[pid].avgRating = 0;
      products[pid].ratingCount = 0;
    }
  }
}

function logout() {
  localStorage.removeItem('academyUser');
  currentUser = null;
  currentUserCode = null;
  cart = {};
  wishlist = {};
  location.reload();
}

function updateHeader() {
  document.getElementById('userPointsMini').textContent = (currentUser?.points || 0);
  updateCartBadge();
  updateWishlistBadge();
}

function updateCartBadge() {
  const count = Object.values(cart).reduce((sum, item) => sum + (item.quantity || 0), 0);
  document.getElementById('cartBadge').textContent = count;
  document.getElementById('cartBadge').style.display = count > 0 ? 'flex' : 'none';
}

function updateWishlistBadge() {
  const count = Object.keys(wishlist).length;
  document.getElementById('wishlistBadge').textContent = count;
  document.getElementById('wishlistBadge').style.display = count > 0 ? 'flex' : 'none';
}

function renderTopStats() {
  const topSales = Object.entries(products)
    .sort((a, b) => (globalSales[b[0]] || 0) - (globalSales[a[0]] || 0))
    .slice(0, 10);
  
  const topRated = Object.entries(products)
    .filter(([_, p]) => p.avgRating > 0)
    .sort((a, b) => b[1].avgRating - a[1].avgRating)
    .slice(0, 10);
  
  window.topSalesProducts = topSales;
  window.topRatedProducts = topRated;
}

function renderCategories() {
  const list = document.getElementById('categoriesList');
  list.innerHTML = categories.map(cat => `
    <li class="category-item">
      <button class="category-btn ${cat.id === 'all' ? 'active' : ''}" onclick="filterCategory('${cat.id}')">
        <i class="fas ${cat.icon}"></i> ${cat.name}
      </button>
    </li>
  `).join('');
}

function renderHomeSections() {
  const container = document.getElementById('mainContainer');
  container.innerHTML = '';
  
  if (window.topSalesProducts && window.topSalesProducts.length > 0) {
    container.innerHTML += createScrollSection('Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø¨ÙŠØ¹Ø§Ù‹ ğŸ”¥', 'top-sales', window.topSalesProducts);
  }
  
  if (window.topRatedProducts && window.topRatedProducts.length > 0) {
    container.innerHTML += createScrollSection('Ø§Ù„Ø£Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…Ø§Ù‹ â­', 'top-rated', window.topRatedProducts);
  }
  
  categories.forEach(cat => {
    if (cat.id === 'all') return;
    const catProducts = Object.entries(products).filter(([_, p]) => p.category === cat.id).slice(0, 6);
    if (catProducts.length > 0) {
      container.innerHTML += createScrollSection(cat.name, cat.id, catProducts);
    }
  });
}

function createScrollSection(title, catId, items) {
  return `
    <div class="section-header">
      <h2 class="section-title">${title}</h2>
      <button class="view-all-btn" onclick="showCategoryPage('${catId}')">
        Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„ <i class="fas fa-arrow-left"></i>
      </button>
    </div>
    <div class="scroll-container">
      <div class="scroll-wrapper">
        <div class="products-scroll">
          ${items.map(([pid, p]) => createProductCard(pid, p)).join('')}
        </div>
      </div>
    </div>
  `;
}

function createProductCard(pid, p) {
  const salesCount = globalSales[pid] || 0;
  const isWishlisted = wishlist[pid];
  const inCart = cart[pid];
  const rating = p.avgRating || 0;
  
  return `
    <div class="product-card" onclick="openProductDetail('${pid}')">
      <div class="product-image-wrapper">
        <img src="${p.images?.[0] || p.image}" class="product-image" alt="${p.name}">
        ${p.discount > 0 ? `<div class="discount-badge">-${p.discount}%</div>` : ''}
        ${rating > 0 ? `
          <div class="rating-badge">
            <i class="fas fa-star"></i> ${rating}
          </div>
        ` : ''}
        <div class="sales-badge">${salesCount} Ù…Ø¨Ø§Ø¹</div>
        <button class="wishlist-btn ${isWishlisted ? 'active' : ''}" onclick="event.stopPropagation(); toggleWishlist('${pid}')">
          <i class="fas fa-heart"></i>
        </button>
      </div>
      <div class="card-content">
        <h3 class="product-title">${p.name}</h3>
        <div class="price-row">
          <span class="current-price">${p.price} Ù†Ù‚Ø·Ø©</span>
          ${p.originalPrice ? `<span class="original-price">${p.originalPrice}</span>` : ''}
        </div>
        ${rating > 0 ? `
          <div class="rating">
            <i class="fas fa-star"></i>
            <span>${rating}</span>
            <span style="color: var(--text-light);">(${p.ratingCount})</span>
          </div>
        ` : ''}
        <button class="add-cart-btn ${inCart ? 'added' : ''}" onclick="event.stopPropagation(); addToCart('${pid}')">
          <i class="fas ${inCart ? 'fa-check' : 'fa-shopping-cart'}"></i>
          ${inCart ? 'ÙÙŠ Ø§Ù„Ø³Ù„Ø©' : 'Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©'}
        </button>
      </div>
    </div>
  `;
}

function showTopSales() {
  const container = document.getElementById('mainContainer');
  container.innerHTML = `
    <div class="page-container">
      <div class="page-header">
        <h2 class="page-title"><i class="fas fa-fire" style="color: var(--danger);"></i> Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø¨ÙŠØ¹Ø§Ù‹</h2>
        <button class="back-btn" onclick="renderHomeSections()">
          <i class="fas fa-arrow-right"></i> Ø±Ø¬ÙˆØ¹
        </button>
      </div>
      <div class="products-grid">
        ${window.topSalesProducts.map(([pid, p]) => createProductCard(pid, p)).join('')}
      </div>
    </div>
  `;
  window.scrollTo(0, 0);
}

function showTopRated() {
  const container = document.getElementById('mainContainer');
  container.innerHTML = `
    <div class="page-container">
      <div class="page-header">
        <h2 class="page-title"><i class="fas fa-star" style="color: var(--secondary);"></i> Ø§Ù„Ø£Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…Ø§Ù‹</h2>
        <button class="back-btn" onclick="renderHomeSections()">
          <i class="fas fa-arrow-right"></i> Ø±Ø¬ÙˆØ¹
        </button>
      </div>
      <div class="products-grid">
        ${window.topRatedProducts.map(([pid, p]) => createProductCard(pid, p)).join('')}
      </div>
    </div>
  `;
  window.scrollTo(0, 0);
}

function toggleWishlist(pid) {
  if (wishlist[pid]) {
    delete wishlist[pid];
  } else {
    wishlist[pid] = true;
  }
  
  database.ref(`userWishlists/${currentUserCode}`).set(wishlist);
  updateWishlistBadge();
  renderHomeSections();
}

function addToCart(pid) {
  if (cart[pid]) {
    cart[pid].quantity++;
  } else {
    cart[pid] = {
      quantity: 1,
      addedAt: Date.now()
    };
  }
  
  database.ref(`userCarts/${currentUserCode}`).set(cart);
  updateCartBadge();
  renderHomeSections();
}

function removeFromCart(pid) {
  delete cart[pid];
  database.ref(`userCarts/${currentUserCode}`).set(cart);
  updateCartBadge();
  showCartPage();
}

function updateCartQuantity(pid, change) {
  if (!cart[pid]) return;
  
  cart[pid].quantity += change;
  if (cart[pid].quantity <= 0) {
    delete cart[pid];
  }
  
  database.ref(`userCarts/${currentUserCode}`).set(cart);
  updateCartBadge();
  showCartPage();
}

function showCartPage() {
  const container = document.getElementById('mainContainer');
  const cartItems = Object.entries(cart);
  const totalPoints = cartItems.reduce((sum, [pid, item]) => {
    return sum + ((products[pid]?.price || 0) * item.quantity);
  }, 0);
  
  if (cartItems.length === 0) {
    container.innerHTML = `
      <div class="page-container">
        <button class="back-btn" onclick="renderHomeSections()" style="margin-bottom: 20px;">
          <i class="fas fa-arrow-right"></i> Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù…ØªØ¬Ø±
        </button>
        <div class="empty-state">
          <i class="fas fa-shopping-cart"></i>
          <h3>Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</h3>
          <p>Ø£Ø¶Ù Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„Ø¨Ø¯Ø¡</p>
        </div>
      </div>
    `;
    return;
  }
  
  container.innerHTML = `
    <div class="page-container">
      <div class="page-header">
        <h2 class="page-title"><i class="fas fa-shopping-cart" style="color: var(--primary);"></i> Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚</h2>
        <button class="back-btn" onclick="renderHomeSections()">
          <i class="fas fa-arrow-right"></i> Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªØ³ÙˆÙ‚
        </button>
      </div>
      
      ${cartItems.map(([pid, item]) => {
        const p = products[pid];
        if (!p) return '';
        return `
          <div class="cart-item">
            <img src="${p.images?.[0] || p.image}" class="cart-item-image" alt="${p.name}">
            <div class="cart-item-details">
              <div class="cart-item-title">${p.name}</div>
              <div class="cart-item-price">${p.price} Ù†Ù‚Ø·Ø© Ã— ${item.quantity} = ${p.price * item.quantity} Ù†Ù‚Ø·Ø©</div>
              <div class="cart-item-actions">
                <div class="quantity-control">
                  <button class="qty-btn" onclick="updateCartQuantity('${pid}', -1)">-</button>
                  <span class="qty-value">${item.quantity}</span>
                  <button class="qty-btn" onclick="updateCartQuantity('${pid}', 1)">+</button>
                </div>
                <button class="remove-btn" onclick="removeFromCart('${pid}')">
                  <i class="fas fa-trash"></i> Ø­Ø°Ù
                </button>
              </div>
            </div>
          </div>
        `;
      }).join('')}
      
      <div class="cart-summary">
        <div class="summary-row">
          <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:</span>
          <span>${totalPoints} Ù†Ù‚Ø·Ø©</span>
        </div>
        <div class="summary-row">
          <span>Ø±ØµÙŠØ¯Ùƒ:</span>
          <span>${currentUser?.points || 0} Ù†Ù‚Ø·Ø©</span>
        </div>
        <div class="summary-row total">
          <span>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø´Ø±Ø§Ø¡:</span>
          <span>${(currentUser?.points || 0) - totalPoints} Ù†Ù‚Ø·Ø©</span>
        </div>
        <button class="checkout-btn" onclick="checkout()">
          <i class="fas fa-check-circle"></i> ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø´Ø±Ø§Ø¡
        </button>
      </div>
    </div>
  `;
}

function checkout() {
  const totalPoints = Object.entries(cart).reduce((sum, [pid, item]) => {
    return sum + ((products[pid]?.price || 0) * item.quantity);
  }, 0);
  
  if (totalPoints > (currentUser?.points || 0)) {
    alert('Ø±ØµÙŠØ¯Ùƒ ØºÙŠØ± ÙƒØ§ÙÙŠ!');
    return;
  }
  
  if (!confirm(`ØªØ£ÙƒÙŠØ¯ Ø´Ø±Ø§Ø¡ ${Object.keys(cart).length} Ù…Ù†ØªØ¬ Ø¨Ù‚ÙŠÙ…Ø© ${totalPoints} Ù†Ù‚Ø·Ø©ØŸ`)) {
    return;
  }
  
  const updates = {};
  let newPoints = currentUser.points;
  
  Object.entries(cart).forEach(([pid, item]) => {
    const p = products[pid];
    const owner = users[p.ownerCode];
    const itemTotal = p.price * item.quantity;
    
    newPoints -= itemTotal;
    
    if (owner) {
      updates[`users/${p.ownerCode}/points`] = (owner.points || 0) + itemTotal;
    }
    
    const currentSales = globalSales[pid] || 0;
    updates[`globalSales/${pid}`] = currentSales + item.quantity;
    
    sendToTelegram(pid, item.quantity);
  });
  
  updates[`users/${currentUserCode}/points`] = newPoints;
  updates[`userCarts/${currentUserCode}`] = null;
  
  database.ref().update(updates).then(() => {
    alert('âœ… ØªÙ… Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­!');
    cart = {};
    currentUser.points = newPoints;
    updateHeader();
    updateCartBadge();
    renderHomeSections();
  });
}

function sendToTelegram(pid, quantity) {
  const p = products[pid];
  const message = `ğŸ›’ *Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡ Ø¬Ø¯ÙŠØ¯*\n\n` +
    `ğŸ“± *Ø§Ù„Ø±Ù‚Ù…:* ${currentUserCode}\n` +
    `ğŸ‘¤ *Ø§Ù„Ø§Ø³Ù…:* ${currentUser?.name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}\n` +
    `ğŸ“¦ *Ø§Ù„Ù…Ù†ØªØ¬:* ${p.name}\n` +
    `ğŸ”¢ *Ø§Ù„ÙƒÙ…ÙŠØ©:* ${quantity}\n` +
    `ğŸ’° *Ø§Ù„Ø³Ø¹Ø±:* ${p.price * quantity} Ù†Ù‚Ø·Ø©\n` +
    `ğŸ’³ *Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:* ${currentUser?.points || 0} Ù†Ù‚Ø·Ø©`;
    
  let keyboard = { inline_keyboard: [] };
  
  if (currentUser?.whatsappLink) {
    keyboard.inline_keyboard.push([{
      text: "ğŸ“± ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨",
      url: currentUser.whatsappLink
    }]);
  }
  
  if (currentUser?.telegramId) {
    keyboard.inline_keyboard.push([{
      text: "ğŸ‘¤ ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ØªÙ„ÙŠØ¬Ø±Ø§Ù…",
      url: `tg://user?id=${currentUser.telegramId}`
    }]);
  }
  
  fetch(`https://api.telegram.org/bot7823121427:AAFAQUIObZPEEhAK18nzWtem9oH7AIqF6ek/sendMessage`, {
    method: "POST",
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      chat_id: "-1001573316681",
      text: message,
      parse_mode: "Markdown",
      reply_markup: keyboard.inline_keyboard.length > 0 ? keyboard : undefined
    })
  }).catch(console.error);
}

function showWishlistPage() {
  const container = document.getElementById('mainContainer');
  const wishlistItems = Object.keys(wishlist);
  
  if (wishlistItems.length === 0) {
    container.innerHTML = `
      <div class="page-container">
        <button class="back-btn" onclick="renderHomeSections()" style="margin-bottom: 20px;">
          <i class="fas fa-arrow-right"></i> Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù…ØªØ¬Ø±
        </button>
        <div class="empty-state">
          <i class="fas fa-heart"></i>
          <h3>Ø§Ù„Ù…ÙØ¶Ù„Ø© ÙØ§Ø±ØºØ©</h3>
          <p>Ø£Ø¶Ù Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„Ù…ÙØ¶Ù„Ø© Ù„Ø±Ø¤ÙŠØªÙ‡Ø§ Ù‡Ù†Ø§</p>
        </div>
      </div>
    `;
    return;
  }
  
  container.innerHTML = `
    <div class="page-container">
      <div class="page-header">
        <h2 class="page-title"><i class="fas fa-heart" style="color: var(--danger);"></i> Ø§Ù„Ù…ÙØ¶Ù„Ø©</h2>
        <button class="back-btn" onclick="renderHomeSections()">
          <i class="fas fa-arrow-right"></i> Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù…ØªØ¬Ø±
        </button>
      </div>
      <div class="products-grid">
        ${wishlistItems.map(pid => {
          const p = products[pid];
          if (!p) return '';
          return createProductCard(pid, p);
        }).join('')}
      </div>
    </div>
  `;
}

function openRatingModal(pid) {
  currentProduct = { id: pid, ...products[pid] };
  currentRating = 0;
  document.getElementById('ratingModal').classList.add('show');
  updateStars(0);
}

function closeRatingModal() {
  document.getElementById('ratingModal').classList.remove('show');
}

function updateStars(rating) {
  currentRating = rating;
  const stars = document.querySelectorAll('.star-btn');
  stars.forEach((star, index) => {
    if (index < rating) {
      star.classList.add('active');
      star.innerHTML = '<i class="fas fa-star"></i>';
    } else {
      star.classList.remove('active');
      star.innerHTML = '<i class="far fa-star"></i>';
    }
  });
}

function submitRating() {
  if (currentRating === 0) return;
  
  const updates = {};
  updates[`productRatings/${currentProduct.id}/${currentUserCode}`] = currentRating;
  
  database.ref().update(updates).then(() => {
    if (!productRatings[currentProduct.id]) {
      productRatings[currentProduct.id] = {};
    }
    productRatings[currentProduct.id][currentUserCode] = currentRating;
    
    calculateProductRatings();
    closeRatingModal();
    renderHomeSections();
    
    if (document.getElementById('detailModal').classList.contains('show')) {
      openProductDetail(currentProduct.id);
    }
  });
}

function openProductDetail(pid) {
  const p = products[pid];
  if (!p) return;
  
  currentProduct = { id: pid, ...p };
  currentImages = p.images || [p.image];
  currentImageIndex = 0;
  
  document.getElementById('detailTitle').textContent = p.name;
  document.getElementById('detailCurrentPrice').textContent = (p.price || 0) + ' Ù†Ù‚Ø·Ø©';
  document.getElementById('detailOriginalPrice').textContent = (p.originalPrice || 0) + ' Ù†Ù‚Ø·Ø©';
  document.getElementById('detailDiscount').textContent = '-' + (p.discount || 0) + '%';
  document.getElementById('detailSales').textContent = globalSales[pid] || 0;
  document.getElementById('detailDesc').textContent = p.description || 'Ù…Ù†ØªØ¬ Ù…Ù…ÙŠØ² Ù…Ù† Ù…ØªØ¬Ø± Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©';
  
  const ratingValue = document.getElementById('detailRatingValue');
  const ratingCount = document.getElementById('detailRatingCount');
  if (ratingValue && ratingCount) {
    ratingValue.textContent = p.avgRating || '0.0';
    ratingCount.textContent = `(${p.ratingCount || 0} ØªÙ‚ÙŠÙŠÙ…)`;
  }
  
  updateDetailImage();
  renderImageDots();
  
  document.getElementById('detailModal').classList.add('show');
  document.body.style.overflow = 'hidden';
}

function updateDetailImage() {
  document.getElementById('detailImage').src = currentImages[currentImageIndex];
}

function renderImageDots() {
  document.getElementById('imageDots').innerHTML = currentImages.map((_, i) => `
    <div class="dot ${i === currentImageIndex ? 'active' : ''}" onclick="goToImage(${i})"></div>
  `).join('');
}

function goToImage(i) {
  currentImageIndex = i;
  updateDetailImage();
  renderImageDots();
}

function nextImage() {
  currentImageIndex = (currentImageIndex + 1) % currentImages.length;
  updateDetailImage();
  renderImageDots();
}

function prevImage() {
  currentImageIndex = (currentImageIndex - 1 + currentImages.length) % currentImages.length;
  updateDetailImage();
  renderImageDots();
}

function openFullGallery() {
  document.getElementById('galleryModal').classList.add('show');
  renderGallery();
  updateGalleryImage();
}

function closeGallery() {
  document.getElementById('galleryModal').classList.remove('show');
}

function renderGallery() {
  document.getElementById('galleryThumbs').innerHTML = currentImages.map((img, i) => `
    <div class="thumbnail ${i === currentImageIndex ? 'active' : ''}" onclick="setGalleryImage(${i})">
      <img src="${img}" alt="">
    </div>
  `).join('');
}

function updateGalleryImage() {
  document.getElementById('galleryMainImage').src = currentImages[currentImageIndex];
  document.getElementById('galleryCounter').textContent = `${currentImageIndex + 1} / ${currentImages.length}`;
  renderGallery();
}

function setGalleryImage(i) {
  currentImageIndex = i;
  updateGalleryImage();
}

function nextGalleryImage() {
  currentImageIndex = (currentImageIndex + 1) % currentImages.length;
  updateGalleryImage();
}

function prevGalleryImage() {
  currentImageIndex = (currentImageIndex - 1 + currentImages.length) % currentImages.length;
  updateGalleryImage();
}

function closeDetail() {
  document.getElementById('detailModal').classList.remove('show');
  document.body.style.overflow = 'auto';
}

function filterCategory(catId) {
  document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
  event.target.closest('.category-btn').classList.add('active');
  
  if (catId === 'all') {
    renderHomeSections();
  } else {
    showCategoryPage(catId);
  }
}

function showCategoryPage(catId) {
  const cat = categories.find(c => c.id === catId);
  const items = Object.entries(products).filter(([_, p]) => 
    catId === 'top-sales' ? window.topSalesProducts.some(([id]) => id === _) :
    catId === 'top-rated' ? window.topRatedProducts.some(([id]) => id === _) :
    p.category === catId
  );
  
  document.getElementById('mainContainer').innerHTML = `
    <div class="page-container">
      <div class="page-header">
        <button class="back-btn" onclick="renderHomeSections()">
          <i class="fas fa-arrow-right"></i> Ø±Ø¬ÙˆØ¹
        </button>
        <h2 class="page-title">${cat?.name || 'Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª'}</h2>
        <span style="color: var(--text-light);">${items.length} Ù…Ù†ØªØ¬</span>
      </div>
      <div class="products-grid">
        ${items.map(([pid, p]) => createProductCard(pid, p)).join('')}
      </div>
    </div>
  `;
  window.scrollTo(0, 0);
}

// Keyboard navigation
document.addEventListener('keydown', (e) => {
  if (document.getElementById('galleryModal').classList.contains('show')) {
    if (e.key === 'ArrowRight') nextGalleryImage();
    if (e.key === 'ArrowLeft') prevGalleryImage();
    if (e.key === 'Escape') closeGallery();
  }
});
</script>
</head>
<body>

<!-- Login Modal -->
<div class="login-modal" id="loginModal">
  <div class="login-content">
    <div class="login-logo">ğŸ“</div>
    <h1 class="login-title">Ù…ØªØ¬Ø± Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©</h1>
    <p class="login-subtitle">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ù„ØªØ³ÙˆÙ‚ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ù‚Ø§Ø·Ùƒ</p>
    
    <div class="login-input-group">
      <label>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ</label>
      <input type="text" id="loginCode" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù…Ùƒ">
    </div>
    
    <div class="login-input-group">
      <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</label>
      <input type="password" id="loginPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢">
    </div>
    
    <div class="login-error" id="loginError"></div>
    
    <button class="login-btn" onclick="login()">
      <i class="fas fa-sign-in-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    </button>
  </div>
</div>

<!-- Header -->
<header class="store-header">
  <div class="header-content">
    <div class="logo" onclick="renderHomeSections()">
      <div class="logo-icon"><i class="fas fa-graduation-cap"></i></div>
      <span class="logo-text">Ù…ØªØ¬Ø± Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©</span>
    </div>
    
    <div style="display: flex; align-items: center; gap: 12px;">
      <div class="user-points-mini">
        <i class="fas fa-coins"></i>
        <span id="userPointsMini">0</span>
      </div>
      
      <div class="header-actions">
        <button class="icon-btn" onclick="showWishlistPage()" title="Ø§Ù„Ù…ÙØ¶Ù„Ø©">
          <i class="fas fa-heart"></i>
          <span class="badge" id="wishlistBadge" style="display: none;">0</span>
        </button>
        <button class="icon-btn" onclick="showCartPage()" title="Ø§Ù„Ø³Ù„Ø©">
          <i class="fas fa-shopping-cart"></i>
          <span class="badge" id="cartBadge" style="display: none;">0</span>
        </button>
      </div>
    </div>
  </div>
</header>

<!-- Top Stats -->
<div class="top-stats-section">
  <div class="stats-container">
    <div class="stat-card" onclick="showTopSales()">
      <div class="stat-icon">ğŸ”¥</div>
      <div class="stat-info">
        <span class="stat-title">Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø¨ÙŠØ¹Ø§Ù‹</span>
        <span class="stat-subtitle">Ø£ÙØ¶Ù„ 10 Ù…Ù†ØªØ¬Ø§Øª</span>
      </div>
    </div>
    <div class="stat-card rated" onclick="showTopRated()">
      <div class="stat-icon">â­</div>
      <div class="stat-info">
        <span class="stat-title">Ø§Ù„Ø£Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…Ø§Ù‹</span>
        <span class="stat-subtitle">Ø£ÙØ¶Ù„ 10 ØªÙ‚ÙŠÙŠÙ…Ø§Øª</span>
      </div>
    </div>
  </div>
</div>

<!-- Categories -->
<nav class="categories-nav">
  <ul class="categories-list" id="categoriesList"></ul>
</nav>

<!-- Main -->
<main class="store-container" id="mainContainer">
  <div class="loading">
    <div class="spinner"></div>
    Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...
  </div>
</main>

<!-- Rating Modal -->
<div class="rating-modal" id="ratingModal">
  <div class="rating-content">
    <h3 class="rating-title">Ù‚ÙŠÙ… Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬</h3>
    <p class="rating-subtitle">Ø§Ø®ØªØ± Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ø¬ÙˆÙ…</p>
    
    <div class="stars-container">
      <button class="star-btn" onclick="updateStars(1)"><i class="far fa-star"></i></button>
      <button class="star-btn" onclick="updateStars(2)"><i class="far fa-star"></i></button>
      <button class="star-btn" onclick="updateStars(3)"><i class="far fa-star"></i></button>
      <button class="star-btn" onclick="updateStars(4)"><i class="far fa-star"></i></button>
      <button class="star-btn" onclick="updateStars(5)"><i class="far fa-star"></i></button>
    </div>
    
    <div class="rating-actions">
      <button class="submit-rating" onclick="submitRating()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</button>
      <button class="cancel-rating" onclick="closeRatingModal()">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
  </div>
</div>

<!-- Product Detail Modal -->
<div class="detail-modal" id="detailModal">
  <div class="detail-content">
    <div class="detail-header">
      <button class="icon-btn" onclick="closeDetail()" style="width: 36px; height: 36px;">
        <i class="fas fa-arrow-right"></i>
      </button>
      <span style="font-weight: 700;">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</span>
      <div style="width: 36px;"></div>
    </div>
    
    <div class="detail-image-section">
      <img id="detailImage" src="" class="detail-image" alt="">
      <div class="image-dots" id="imageDots"></div>
      <button class="expand-image-btn" onclick="openFullGallery()">
        <i class="fas fa-expand"></i>
      </button>
      <button class="gallery-nav gallery-prev" onclick="nextImage()">
        <i class="fas fa-chevron-right"></i>
      </button>
      <button class="
