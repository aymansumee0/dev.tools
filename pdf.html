<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ± Ùˆ PDF</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family: sans-serif;
  background:#f2f5fa;
  margin:0;
  padding:15px;
}
.box{
  background:#fff;
  border-radius:12px;
  padding:15px;
  margin-bottom:15px;
}
button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:10px;
  font-size:16px;
  color:#fff;
  cursor:pointer;
}
.blue{background:#123b5d}
.green{background:#198754}
.red{background:#dc3545}
input{display:none}
.note{
  font-size:13px;
  color:#555;
  margin-top:8px;
}
</style>
</head>

<body>

<div class="box">
  <h3>ğŸ–¼ï¸ ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ± Ø¥Ù„Ù‰ PDF</h3>
  <label class="blue">
    <button onclick="pickImages()">Ø§Ø®ØªØ± ØµÙˆØ± (Ù…ØªØ¹Ø¯Ø¯)</button>
  </label>
  <br><br>
  <button class="blue" onclick="makePDF()">Ø­ÙØ¸ PDF</button>
  <div class="note">Ø§Ù„Ø­ÙØ¸ ÙÙŠ: TataworAPP/PDF</div>
</div>

<div class="box">
  <h3>ğŸ“„ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØµÙˆØ± Ù…Ù† PDF</h3>
  <label>
    <button class="green" onclick="pickPDF()">Ø§Ø®ØªØ± Ù…Ù„Ù PDF</button>
  </label>
  <br><br>
  <button class="green" onclick="extractImages()">Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±</button>
  <div class="note">Ø§Ù„Ø­ÙØ¸ ÙÙŠ: TataworAPP/ØµÙˆØ±</div>
</div>

<div class="box">
  <button class="red" onclick="history.back()">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø£Ø¯Ø§Ø©</button>
</div>

<input id="imagesInput" type="file" accept="image/*" multiple>
<input id="pdfInput" type="file" accept="application/pdf">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>

<script>
let images = [];
let pdfFile = null;

function pickImages(){
  document.getElementById("imagesInput").click();
}

function pickPDF(){
  document.getElementById("pdfInput").click();
}

document.getElementById("imagesInput").onchange = e=>{
  images = [...e.target.files];
};

document.getElementById("pdfInput").onchange = e=>{
  pdfFile = e.target.files[0];
};

// ===== ØµÙˆØ± âœ PDF (Ù…ØªØ¹Ø¯Ø¯) =====
async function makePDF(){
  if(images.length === 0){
    alert("Ø§Ø®ØªØ± ØµÙˆØ± Ø£ÙˆÙ„Ø§Ù‹");
    return;
  }

  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();

  for(let i=0;i<images.length;i++){
    const img = await fileToBase64(images[i]);
    const image = new Image();
    image.src = img;
    await image.decode();

    const w = pdf.internal.pageSize.getWidth();
    const h = (image.height * w) / image.width;

    if(i>0) pdf.addPage();
    pdf.addImage(img,"PNG",0,0,w,h);
  }

  const base64 = pdf.output("datauristring");
  Android.savePDF(
    base64,
    "images_" + Date.now() + ".pdf"
  );
}

// ===== PDF âœ ØµÙˆØ± =====
async function extractImages(){
  if(!pdfFile){
    alert("Ø§Ø®ØªØ± Ù…Ù„Ù PDF");
    return;
  }

  const data = await pdfFile.arrayBuffer();
  const pdf = await pdfjsLib.getDocument({data}).promise;

  for(let i=1;i<=pdf.numPages;i++){
    const page = await pdf.getPage(i);
    const viewport = page.getViewport({scale:2});
    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");

    canvas.width = viewport.width;
    canvas.height = viewport.height;

    await page.render({canvasContext:ctx,viewport}).promise;

    const img = canvas.toDataURL("image/png");
    Android.saveImage(
      img,
      "pdf_img_" + i + "_" + Date.now() + ".png"
    );
  }
}

// ===== helper =====
function fileToBase64(file){
  return new Promise(res=>{
    const r = new FileReader();
    r.onload = ()=>res(r.result);
    r.readAsDataURL(file);
  });
}
</script>

</body>
</html>
