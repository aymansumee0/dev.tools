<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
@import url('https://fonts.googleapis.com/css2?family=Cairo&display=swap');

body{
  font-family:'Cairo',sans-serif;
  background:#eef2ff;
  margin:0;
  padding:25px;
  min-height:100vh;
}

.app{
  max-width:460px;
  width:100%;
  margin:0 auto;
}

.tools-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
  gap:20px;
}

.tool-card{
  border-radius:18px;
  padding:25px 15px;
  text-align:center;
  cursor:pointer;
  user-select:none;
  color:#fff;
  box-shadow:0 8px 18px rgba(0,0,0,.12);
}
.tool-icon{font-size:42px;margin-bottom:15px}
.tool-label{font-weight:700;font-size:18px}

.gradient-1{background:linear-gradient(135deg,#43cea2,#185a9d)}
.gradient-2{background:linear-gradient(135deg,#f7971e,#ffd200);color:#3a2e00}

.screen{display:none}
.screen.active{display:block}

.tool-box{
  background:#fff;
  border-radius:18px;
  padding:16px;
  box-shadow:0 8px 18px rgba(0,0,0,.12);
}

.close-btn{
  margin-top:20px;
  width:100%;
  padding:14px;
  border:none;
  border-radius:14px;
  background:linear-gradient(135deg,#ff416c,#ff4b2b);
  color:#fff;
  font-size:16px;
  font-weight:800;
  cursor:pointer;
}

.file-input{
  position:absolute;
  inset:0;
  opacity:0;
}
.preview{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  justify-content:center;
  margin:12px 0;
}
.preview img{
  width:60px;
  height:60px;
  object-fit:cover;
  border-radius:6px;
}
</style>
</head>

<body>
<div class="app">

<!-- Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
<div id="home" class="screen active">
  <div class="tools-grid">

    <div class="tool-card gradient-1" onclick="openTool('tool_img_pdf')">
      <div class="tool-icon">ğŸ–¼ï¸</div>
      <div class="tool-label">ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ± Ø¥Ù„Ù‰ PDF</div>
    </div>

    <div class="tool-card gradient-2" onclick="openTool('tool_pdf_images')">
      <div class="tool-icon">ğŸ“„</div>
      <div class="tool-label">Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØµÙˆØ± Ù…Ù† PDF</div>
    </div>

  </div>
</div>

<!-- ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ± Ø¥Ù„Ù‰ PDF -->
<div id="tool_img_pdf" class="screen">
  <div class="tool-box">
    <h3 style="text-align:center">ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ± Ø¥Ù„Ù‰ PDF</h3>

    <label style="display:block;text-align:center;border:2px dashed #0c3152;
      border-radius:8px;padding:15px;cursor:pointer;position:relative;">
      Ø§Ø®ØªØ± ØµÙˆØ±
      <input type="file" id="imageInput" accept="image/*" multiple class="file-input">
    </label>

    <div id="preview" class="preview"></div>

    <button onclick="generatePDF()" style="width:100%;padding:10px;
      background:#0c3152;color:#fff;border:none;border-radius:8px;">
      ØªØ­Ù…ÙŠÙ„ PDF
    </button>

    <button class="close-btn" onclick="goHome()">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø£Ø¯Ø§Ø©</button>
  </div>
</div>

<!-- Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØµÙˆØ± Ù…Ù† PDF -->
<div id="tool_pdf_images" class="screen">
  <div class="tool-box">
    <h3 style="text-align:center">Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØµÙˆØ± Ù…Ù† PDF</h3>

    <label style="display:block;text-align:center;border:2px dashed #0c3152;
      border-radius:8px;padding:15px;cursor:pointer;position:relative;">
      Ø§Ø®ØªØ± Ù…Ù„Ù PDF
      <input type="file" id="pdfInput" accept="application/pdf" class="file-input">
    </label>

    <div id="pdfImages" class="preview"></div>

    <button onclick="downloadAllImages()" style="width:100%;padding:10px;
      background:#198754;color:#fff;border:none;border-radius:8px;">
      ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙˆØ±
    </button>

    <button class="close-btn" onclick="goHome()">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø£Ø¯Ø§Ø©</button>
  </div>
</div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>

<script>
function hideAll(){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
}
function goHome(){
  hideAll();
  document.getElementById('home').classList.add('active');
}
function openTool(id){
  hideAll();
  document.getElementById(id).classList.add('active');
}

/* ===== IMAGE TO PDF (FIX MULTI IMAGE) ===== */
let images = [];
const imageInput = document.getElementById("imageInput");
const preview = document.getElementById("preview");

imageInput.addEventListener("change", function () {
  preview.innerHTML = "";
  images = [];

  const files = Array.from(this.files);

  files.forEach(file => {
    if (!file.type.startsWith("image/")) return;

    images.push(file);

    const reader = new FileReader();
    reader.onload = e => {
      const img = document.createElement("img");
      img.src = e.target.result;
      preview.appendChild(img);
    };
    reader.readAsDataURL(file);
  });
});

async function generatePDF(){
  if(images.length === 0){
    alert("Ø§Ø®ØªØ± ØµÙˆØ± Ø£ÙˆÙ„Ø§Ù‹");
    return;
  }

  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();

  for(let i=0;i<images.length;i++){
    const dataUrl = await new Promise(resolve=>{
      const r = new FileReader();
      r.onload = ()=>resolve(r.result);
      r.readAsDataURL(images[i]);
    });

    if(i>0) pdf.addPage();
    pdf.addImage(dataUrl,"JPEG",0,0,210,297);
  }

  const base64 = pdf.output("datauristring");
  Android.saveBase64File(base64,"images.pdf");
}

/* ===== PDF EXTRACT ===== */
let extracted = [];
const pdfInput = document.getElementById("pdfInput");
const pdfImages = document.getElementById("pdfImages");

pdfInput.addEventListener("change", async ()=>{
  pdfImages.innerHTML = "";
  extracted = [];

  const buf = await pdfInput.files[0].arrayBuffer();
  const pdf = await pdfjsLib.getDocument({data:buf}).promise;

  for(let i=1;i<=pdf.numPages;i++){
    const page = await pdf.getPage(i);
    const vp = page.getViewport({scale:2});
    const c = document.createElement("canvas");
    c.width = vp.width;
    c.height = vp.height;

    await page.render({
      canvasContext:c.getContext("2d"),
      viewport:vp
    }).promise;

    const data = c.toDataURL("image/png");
    extracted.push(data);

    const img = document.createElement("img");
    img.src = data;
    pdfImages.appendChild(img);
  }
});

function downloadAllImages(){
  if(extracted.length === 0){
    alert("Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±");
    return;
  }

  extracted.forEach((data,i)=>{
    Android.saveBase64File(
      data,
      "image-"+(i+1)+".png"
    );
  });
}
</script>

</body>
</html>
