<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>PDF Tools</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>

<style>
body{
  font-family: sans-serif;
  background:#f4f4f4;
  margin:0;
  padding:12px;
}
.section{
  background:#fff;
  padding:12px;
  border-radius:8px;
  margin-bottom:15px;
}
button{
  padding:10px;
  border:none;
  border-radius:6px;
  background:#2196F3;
  color:#fff;
  font-size:15px;
  margin-top:10px;
}
.preview{
  display:flex;
  flex-wrap:wrap;
  margin-top:8px;
}
.preview img{
  width:80px;
  height:auto;
  margin:4px;
  border-radius:5px;
}
</style>
</head>

<body>

<!-- ================= ØµÙˆØ± Ø¥Ù„Ù‰ PDF ================= -->
<div class="section">
<h3>ğŸ–¼ï¸ ØµÙˆØ± â†’ PDF</h3>

<input type="file" id="imgInput" multiple accept="image/*">
<div class="preview" id="imgPreview"></div>

<button onclick="makePDF()">Ø­ÙØ¸ PDF</button>
</div>

<!-- ================= Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØµÙˆØ± ================= -->
<div class="section">
<h3>ğŸ“„ PDF â†’ ØµÙˆØ±</h3>

<input type="file" id="pdfInput" accept="application/pdf">
<div class="preview" id="pdfPreview"></div>

<button onclick="extractImages()">Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±</button>
</div>

<script>
let images64 = [];

// ================= Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ± =================
document.getElementById("imgInput").onchange = e => {
  images64 = [];
  imgPreview.innerHTML = "";

  [...e.target.files].forEach(f=>{
    const r = new FileReader();
    r.onload = ev=>{
      images64.push(ev.target.result);
      const img = document.createElement("img");
      img.src = ev.target.result;
      imgPreview.appendChild(img);
    };
    r.readAsDataURL(f);
  });
};

// ================= Ø¥Ù†Ø´Ø§Ø¡ PDF =================
async function makePDF(){
  if(images64.length === 0){
    alert("Ø§Ø®ØªØ± ØµÙˆØ± Ø£ÙˆÙ„Ø§Ù‹");
    return;
  }

  const pdf = await PDFLib.PDFDocument.create();

  for(const img64 of images64){
    const bytes = await fetch(img64).then(r=>r.arrayBuffer());
    const img = await pdf.embedPng(bytes);
    const page = pdf.addPage([img.width, img.height]);
    page.drawImage(img,{x:0,y:0,width:img.width,height:img.height});
  }

  const pdfBytes = await pdf.save();
  const base64 =
    "data:application/pdf;base64," +
    btoa(String.fromCharCode(...new Uint8Array(pdfBytes)));

  Android.savePDF(base64,"Images_"+Date.now()+".pdf");
  alert("ØªÙ… Ø­ÙØ¸ PDF");
}

// ================= Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØµÙˆØ± =================
function extractImages(){
  const file = pdfInput.files[0];
  if(!file){
    alert("Ø§Ø®ØªØ± Ù…Ù„Ù PDF");
    return;
  }

  pdfPreview.innerHTML = "";

  const r = new FileReader();
  r.onload = ()=>{
    // Ù†Ø±Ø³Ù„ Ø§Ù„Ù…Ù„Ù Ù„Ù„Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯
    Android.extractPDF(r.result,"PDF_"+Date.now());

    // Ù…Ø¹Ø§ÙŠÙ†Ø© ÙˆÙ‡Ù…ÙŠØ© (Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª)
    const img = document.createElement("img");
    img.src =
      "data:image/svg+xml;base64," +
      btoa(`<svg xmlns='http://www.w3.org/2000/svg' width='80' height='100'>
      <rect width='100%' height='100%' fill='#ccc'/>
      <text x='50%' y='50%' dominant-baseline='middle'
      text-anchor='middle' fill='#333'>PDF</text></svg>`);
    pdfPreview.appendChild(img);

    alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±");
  };
  r.readAsDataURL(file);
}
</script>

</body>
</html>
