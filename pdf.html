<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Cairo;background:#eef2ff;margin:0;padding:20px}
.app{max-width:460px;margin:auto}
.screen{display:none}
.screen.active{display:block}
.tool{background:#fff;padding:15px;border-radius:15px}
button{width:100%;padding:12px;border:0;border-radius:10px;color:#fff;font-size:16px}
.close{background:#ff4b2b;margin-top:10px}
.file{border:2px dashed #333;padding:15px;text-align:center;position:relative}
.file input{position:absolute;inset:0;opacity:0}
.preview img{width:60px;margin:4px}
</style>
</head>

<body>
<div class="app">

<div id="home" class="screen active">
  <button style="background:#185a9d" onclick="openTool('imgpdf')">ğŸ–¼ï¸ ØµÙˆØ± â†’ PDF</button><br><br>
  <button style="background:#198754" onclick="openTool('pdfimg')">ğŸ“„ PDF â†’ ØµÙˆØ±</button>
</div>

<!-- ØµÙˆØ± Ø¥Ù„Ù‰ PDF -->
<div id="imgpdf" class="screen">
  <div class="tool">
    <div class="file">
      Ø§Ø®ØªØ± ØµÙˆØ±
      <input type="file" id="imageInput" multiple accept="image/*">
    </div>
    <div id="preview" class="preview"></div>
    <button style="background:#0c3152" onclick="makePDF()">ØªØ­Ù…ÙŠÙ„ PDF</button>
    <button class="close" onclick="goHome()">Ø¥ØºÙ„Ø§Ù‚</button>
  </div>
</div>

<!-- PDF Ø¥Ù„Ù‰ ØµÙˆØ± -->
<div id="pdfimg" class="screen">
  <div class="tool">
    <div class="file">
      Ø§Ø®ØªØ± Ù…Ù„Ù PDF
      <input type="file" id="pdfInput" accept="application/pdf">
    </div>
    <div id="pdfImages" class="preview"></div>
    <button class="close" onclick="goHome()">Ø¥ØºÙ„Ø§Ù‚</button>
  </div>
</div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>

<script>
pdfjsLib.GlobalWorkerOptions.workerSrc =
 "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js";

function openTool(id){
 document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
 document.getElementById(id).classList.add('active');
}
function goHome(){openTool('home');}

/* ØµÙˆØ± â†’ PDF */
let images=[];
imageInput.onchange=e=>{
 images=[...e.target.files];
 preview.innerHTML='';
 images.forEach(f=>{
  const img=new Image();
  img.src=URL.createObjectURL(f);
  preview.appendChild(img);
 });
};

async function makePDF(){
 if(!images.length){alert('Ø§Ø®ØªØ± ØµÙˆØ±');return;}
 const pdf=new jspdf.jsPDF();
 for(let i=0;i<images.length;i++){
  const data=await images[i].arrayBuffer();
  const b64='data:image/jpeg;base64,'+btoa(
    new Uint8Array(data).reduce((d,b)=>d+String.fromCharCode(b),'')
  );
  if(i) pdf.addPage();
  pdf.addImage(b64,'JPEG',0,0,210,297);
 }
 pdf.save('images.pdf');
}

/* PDF â†’ ØµÙˆØ± */
pdfInput.onchange=async()=>{
 pdfImages.innerHTML='';
 const buf=await pdfInput.files[0].arrayBuffer();
 const pdf=await pdfjsLib.getDocument({data:buf}).promise;

 for(let p=1;p<=pdf.numPages;p++){
  const page=await pdf.getPage(p);
  const vp=page.getViewport({scale:2});
  const c=document.createElement('canvas');
  c.width=vp.width;c.height=vp.height;
  await page.render({canvasContext:c.getContext('2d'),viewport:vp}).promise;
  let i=new Image();
  i.src=c.toDataURL('image/png');
  pdfImages.appendChild(i);
 }
};
</script>

</body>
</html>
