<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>PDF Tools</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>

<style>
body{
  font-family: sans-serif;
  background:#f4f4f4;
  margin:0;
  padding:15px;
}
h2{margin-top:0}
.section{
  background:#fff;
  padding:15px;
  border-radius:8px;
  margin-bottom:20px;
}
button{
  padding:10px 14px;
  border:none;
  border-radius:6px;
  background:#2196F3;
  color:#fff;
  font-size:15px;
  margin-top:10px;
}
button.red{background:#f44336}
.preview img{
  width:90px;
  margin:5px;
  border-radius:5px;
}
</style>
</head>

<body>

<!-- ================= ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ± Ø¥Ù„Ù‰ PDF ================= -->
<div class="section">
<h2>ğŸ“„ ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ± Ø¥Ù„Ù‰ PDF</h2>

<input type="file" id="imgInput" multiple accept="image/*"><br>
<div class="preview" id="imgPreview"></div>

<button onclick="createPDF()">Ø­ÙØ¸ PDF</button>
</div>

<!-- ================= Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØµÙˆØ± Ù…Ù† PDF ================= -->
<div class="section">
<h2>ğŸ–¼ï¸ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØµÙˆØ± Ù…Ù† PDF</h2>

<input type="file" id="pdfInput" accept="application/pdf"><br>

<button onclick="extractImages()">Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÙˆØ­ÙØ¸ Ø§Ù„ØµÙˆØ±</button>
</div>

<script>
let imagesBase64 = [];

// ====== Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ± ======
document.getElementById("imgInput").onchange = e => {
  imagesBase64 = [];
  const preview = document.getElementById("imgPreview");
  preview.innerHTML = "";

  [...e.target.files].forEach(f=>{
    const r = new FileReader();
    r.onload = ev=>{
      imagesBase64.push(ev.target.result);
      const img = document.createElement("img");
      img.src = ev.target.result;
      preview.appendChild(img);
    };
    r.readAsDataURL(f);
  });
};

// ====== Ø¥Ù†Ø´Ø§Ø¡ PDF ======
async function createPDF(){
  if(imagesBase64.length === 0){
    alert("Ø§Ø®ØªØ± ØµÙˆØ± Ø£ÙˆÙ„Ø§Ù‹");
    return;
  }

  const pdf = await PDFLib.PDFDocument.create();

  for(const img64 of imagesBase64){
    const bytes = await fetch(img64).then(r=>r.arrayBuffer());
    const img = await pdf.embedPng(bytes);
    const page = pdf.addPage([img.width, img.height]);
    page.drawImage(img,{x:0,y:0,width:img.width,height:img.height});
  }

  const pdfBytes = await pdf.save();
  const base64 =
    "data:application/pdf;base64," +
    btoa(String.fromCharCode(...new Uint8Array(pdfBytes)));

  Android.savePDF(base64,"Images_"+Date.now()+".pdf");
  alert("ØªÙ… Ø­ÙØ¸ PDF");
}

// ====== Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØµÙˆØ± ======
function extractImages(){
  const f = document.getElementById("pdfInput").files[0];
  if(!f){
    alert("Ø§Ø®ØªØ± Ù…Ù„Ù PDF");
    return;
  }

  const r = new FileReader();
  r.onload = ()=>{
    // Ù†Ø±Ø³Ù„ Ø§Ù„Ù…Ù„Ù Ù„Ù„Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯ (Ø§Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÙŠØªÙ… Ù‡Ù†Ø§Ùƒ)
    Android.extractPDF(r.result,"PDF_"+Date.now());
    alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„Ù Ù„Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬");
  };
  r.readAsDataURL(f);
}
</script>

</body>
</html>
