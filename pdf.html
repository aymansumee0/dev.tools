<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>PDF Tools</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>

<style>
body {
  font-family: sans-serif;
  background:#f5f5f5;
  margin:0;
  padding:15px;
}

.card {
  background:#fff;
  padding:20px;
  margin-bottom:15px;
  border-radius:10px;
  box-shadow:0 2px 6px rgba(0,0,0,.1);
  cursor:pointer;
}

.tool {
  display:none;
}

button {
  padding:10px 15px;
  margin-top:10px;
  border:none;
  border-radius:6px;
  background:#4CAF50;
  color:#fff;
  font-size:16px;
}

.close {
  background:#f44336;
}

input {
  margin-top:10px;
}
</style>
</head>

<body>

<!-- ====== Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ====== -->
<div id="home">
  <div class="card" onclick="openTool('img2pdf')">
    ğŸ“„ ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ± Ø¥Ù„Ù‰ PDF
  </div>

  <div class="card" onclick="openTool('pdf2img')">
    ğŸ–¼ï¸ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØµÙˆØ± Ù…Ù† PDF
  </div>
</div>

<!-- ====== Ø£Ø¯Ø§Ø© Ø§Ù„ØµÙˆØ± Ø¥Ù„Ù‰ PDF ====== -->
<div id="img2pdf" class="tool">
  <h3>ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ± Ø¥Ù„Ù‰ PDF</h3>

  <input type="file" multiple accept="image/*" onchange="loadImages(this.files)">
  <br>

  <button onclick="savePDF()">Ø­ÙØ¸ PDF</button>
  <br>

  <button class="close" onclick="closeTool()">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø£Ø¯Ø§Ø©</button>
</div>

<!-- ====== Ø£Ø¯Ø§Ø© Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØµÙˆØ± ====== -->
<div id="pdf2img" class="tool">
  <h3>Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØµÙˆØ± Ù…Ù† PDF</h3>

  <input type="file" accept="application/pdf" onchange="extractImages(this.files[0])">
  <br>

  <button class="close" onclick="closeTool()">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø£Ø¯Ø§Ø©</button>
</div>

<script>
let images = [];

// ÙØªØ­ Ø£Ø¯Ø§Ø©
function openTool(id) {
  document.getElementById("home").style.display = "none";
  document.getElementById(id).style.display = "block";
}

// Ø¥ØºÙ„Ø§Ù‚ Ø£Ø¯Ø§Ø©
function closeTool() {
  document.querySelectorAll(".tool").forEach(t => t.style.display = "none");
  document.getElementById("home").style.display = "block";
  images = [];
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±
function loadImages(files) {
  images = [];
  for (let f of files) {
    const r = new FileReader();
    r.onload = e => images.push(e.target.result);
    r.readAsDataURL(f);
  }
}

// Ø­ÙØ¸ PDF
async function savePDF() {
  if (images.length === 0) {
    alert("Ø§Ø®ØªØ± ØµÙˆØ± Ø£ÙˆÙ„Ø§Ù‹");
    return;
  }

  const pdfDoc = await PDFLib.PDFDocument.create();

  for (let img of images) {
    const bytes = await fetch(img).then(r => r.arrayBuffer());
    const image = await pdfDoc.embedPng(bytes);
    const page = pdfDoc.addPage([image.width, image.height]);
    page.drawImage(image, {x:0,y:0,width:image.width,height:image.height});
  }

  const pdfBytes = await pdfDoc.save();

  const base64 =
    "data:application/pdf;base64," +
    btoa(String.fromCharCode(...new Uint8Array(pdfBytes)));

  Android.savePDF(base64, "Tatawor_" + Date.now() + ".pdf");

  alert("ØªÙ… Ø­ÙØ¸ PDF");
}

// Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØµÙˆØ± (Ù…Ø¨Ø³Ø·)
function extractImages(file) {
  const reader = new FileReader();
  reader.onload = () => {
    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„Ù Ù„Ù„Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯ (Ø§Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¹Ù†Ø¯Ùƒ Ø´ØºØ§Ù„)
    Android.extractPDF(reader.result, file.name);
    alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„Ù Ù„Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬");
  };
  reader.readAsDataURL(file);
}
</script>

</body>
</html>
