<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Ø£Ø¯ÙˆØ§Øª PDF</title>

<style>
body{
  font-family:sans-serif;
  background:#f2f4ff;
  margin:0;
  padding:20px;
}
.home{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:16px;
}
.tool-card{
  background:linear-gradient(135deg,#4e54c8,#6c6ff0);
  color:#fff;
  border-radius:18px;
  padding:30px 10px;
  text-align:center;
  font-size:18px;
  cursor:pointer;
  box-shadow:0 10px 20px rgba(0,0,0,.15);
}
.tool-card span{
  display:block;
  font-size:42px;
  margin-bottom:10px;
}
.tool{display:none}
.card{
  background:#fff;
  border-radius:16px;
  padding:16px;
  box-shadow:0 6px 16px rgba(0,0,0,.1);
}
h3{text-align:center}
button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:10px;
  background:#4e54c8;
  color:#fff;
  font-size:16px;
  margin-top:10px;
}
.close{background:#ff4b4b}
.preview{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin-top:10px;
}
.preview img{
  width:70px;
  height:70px;
  object-fit:cover;
  border-radius:8px;
}
input[type=file]{width:100%;margin-top:10px}
</style>
</head>

<body>

<!-- Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
<div class="home" id="home">
  <div class="tool-card" onclick="openTool('imgToPdf')">
    <span>ğŸ–¼ï¸</span>ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ± Ø¥Ù„Ù‰ PDF
  </div>
  <div class="tool-card" onclick="openTool('pdfToImg')">
    <span>ğŸ“„</span>Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØµÙˆØ± Ù…Ù† PDF
  </div>
</div>

<!-- ØµÙˆØ± â†’ PDF -->
<div class="tool" id="imgToPdf">
  <div class="card">
    <h3>ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ± Ø¥Ù„Ù‰ PDF</h3>
    <input type="file" id="imgInput" accept="image/*" multiple>
    <div class="preview" id="imgPreview"></div>
    <button onclick="makePDF()">Ø­ÙØ¸ PDF</button>
    <button class="close" onclick="closeTool()">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø£Ø¯Ø§Ø©</button>
  </div>
</div>

<!-- PDF â†’ ØµÙˆØ± -->
<div class="tool" id="pdfToImg">
  <div class="card">
    <h3>Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØµÙˆØ± Ù…Ù† PDF</h3>
    <input type="file" id="pdfInput" accept="application/pdf">
    <div class="preview" id="pdfPreview"></div>
    <button onclick="saveImages()">Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±</button>
    <button class="close" onclick="closeTool()">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø£Ø¯Ø§Ø©</button>
  </div>
</div>

<!-- jsPDF (Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† ÙÙ‚Ø· Ù„Ù„ØªØ­ÙˆÙŠÙ„ ØµÙˆØ± â†’ PDF) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<!-- pdf.js Ù…Ø­Ù„ÙŠ (Ø£ÙˆÙÙ„Ø§ÙŠÙ†) -->
<script src="file:///android_asset/pdf.min.js"></script>

<script>
pdfjsLib.GlobalWorkerOptions.workerSrc =
  "file:///android_asset/pdf.min.js";

let imageList=[];
let extractedImages=[];

function openTool(id){
  home.style.display="none";
  document.getElementById(id).style.display="block";
}
function closeTool(){
  document.querySelectorAll(".tool").forEach(t=>t.style.display="none");
  home.style.display="grid";
}

/* ===== ØµÙˆØ± â†’ PDF ===== */
imgInput.onchange=()=>{
  imageList=[];
  imgPreview.innerHTML="";
  [...imgInput.files].forEach(f=>{
    const r=new FileReader();
    r.onload=()=>{
      imageList.push(r.result);
      const i=new Image();
      i.src=r.result;
      imgPreview.appendChild(i);
    };
    r.readAsDataURL(f);
  });
};

function makePDF(){
  if(!imageList.length){
    alert("Ø§Ø®ØªØ± ØµÙˆØ± Ø£ÙˆÙ„Ø§Ù‹");
    return;
  }
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF();
  imageList.forEach((img,i)=>{
    if(i) pdf.addPage();
    pdf.addImage(img,"JPEG",0,0,210,297);
  });

  const base64 =
    pdf.output("datauristring")
       .replace("data:application/pdf;base64,","");

  if(window.Android){
    Android.savePDF(base64,"images_"+Date.now()+".pdf");
    alert("ØªÙ… Ø­ÙØ¸ Ù…Ù„Ù PDF");
  }else{
    alert("ÙŠØ¹Ù…Ù„ Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙÙ‚Ø·");
  }
}

/* ===== PDF â†’ ØµÙˆØ± ===== */
pdfInput.onchange=async()=>{
  extractedImages=[];
  pdfPreview.innerHTML="";
  const buffer=await pdfInput.files[0].arrayBuffer();
  const pdf=await pdfjsLib.getDocument({data:buffer}).promise;

  for(let i=1;i<=pdf.numPages;i++){
    const p=await pdf.getPage(i);
    const vp=p.getViewport({scale:2});
    const c=document.createElement("canvas");
    c.width=vp.width;
    c.height=vp.height;
    await p.render({canvasContext:c.getContext("2d"),viewport:vp}).promise;
    const img=c.toDataURL("image/png");
    extractedImages.push(img);
    const im=new Image();
    im.src=img;
    pdfPreview.appendChild(im);
  }
};

function saveImages(){
  if(!extractedImages.length){
    alert("Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±");
    return;
  }
  extractedImages.forEach((img,i)=>{
    Android.saveImage(
      img,
      "page_"+(i+1)+"_"+Date.now()+".png"
    );
  });
  alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±");
}
</script>

</body>
</html>
