<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
@import url('https://fonts.googleapis.com/css2?family=Cairo&display=swap');

body{
  font-family:'Cairo',sans-serif;
  background:#eef2ff;
  margin:0;
  padding:25px;
  display:flex;
  justify-content:center;
  min-height:100vh;
}
.app{max-width:460px;width:100%}

.tools-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
  gap:20px;
}
.tool-card{
  border-radius:18px;
  padding:25px 15px;
  text-align:center;
  cursor:pointer;
  transition:.25s;
  user-select:none;
  color:#fff;
  box-shadow:0 8px 18px rgba(0,0,0,.12);
}
.tool-icon{font-size:42px;margin-bottom:15px}
.tool-label{font-weight:700;font-size:18px}

.gradient-1{background:linear-gradient(135deg,#43cea2,#185a9d)}
.gradient-2{background:linear-gradient(135deg,#f7971e,#ffd200);color:#3a2e00}

.screen{display:none}
.screen.active{display:block}

.tool-box{
  background:#fff;
  border-radius:18px;
  padding:16px;
  box-shadow:0 8px 18px rgba(0,0,0,.12);
}

.close-btn{
  margin-top:20px;
  width:100%;
  padding:14px;
  border:none;
  border-radius:14px;
  background:linear-gradient(135deg,#ff416c,#ff4b2b);
  color:#fff;
  font-size:16px;
  font-weight:800;
  cursor:pointer;
}

.file-input{
  position:absolute;
  opacity:0;
  width:100%;
  height:100%;
}
</style>
</head>

<body>
<div class="app">

<div id="home" class="screen active">
  <div class="tools-grid">
    <div class="tool-card gradient-1" onclick="openTool('tool_img_pdf')">
      <div class="tool-icon">ğŸ–¼ï¸</div>
      <div class="tool-label">ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ± Ø¥Ù„Ù‰ PDF</div>
    </div>

    <div class="tool-card gradient-2" onclick="openTool('tool_pdf_images')">
      <div class="tool-icon">ğŸ“„</div>
      <div class="tool-label">Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØµÙˆØ± Ù…Ù† PDF</div>
    </div>
  </div>
</div>

<!-- ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ± Ø¥Ù„Ù‰ PDF -->
<div id="tool_img_pdf" class="screen">
  <div class="tool-box">
    <h3 style="text-align:center">ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ± Ø¥Ù„Ù‰ PDF</h3>

    <label style="display:block;text-align:center;border:2px dashed #0c3152;
      border-radius:8px;padding:15px;cursor:pointer;position:relative;">
      Ø§Ø®ØªØ± ØµÙˆØ±
      <input type="file" id="imageInput" accept="image/*" multiple class="file-input">
    </label>

    <div id="preview" style="display:flex;flex-wrap:wrap;gap:8px;
      justify-content:center;margin:12px 0;"></div>

    <button onclick="generatePDF()" style="width:100%;padding:10px;
      background:#0c3152;color:#fff;border:none;border-radius:8px;">
      ØªØ­Ù…ÙŠÙ„ PDF
    </button>

    <button class="close-btn" onclick="goHome()">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø£Ø¯Ø§Ø©</button>
  </div>
</div>

<!-- Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØµÙˆØ± Ù…Ù† PDF -->
<div id="tool_pdf_images" class="screen">
  <div class="tool-box">
    <h3 style="text-align:center">Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØµÙˆØ± Ù…Ù† PDF</h3>

    <label style="display:block;text-align:center;border:2px dashed #0c3152;
      border-radius:8px;padding:15px;cursor:pointer;position:relative;">
      Ø§Ø®ØªØ± Ù…Ù„Ù PDF
      <input type="file" id="pdfInput" accept="application/pdf" class="file-input">
    </label>

    <div id="pdfImages" style="display:flex;flex-wrap:wrap;gap:8px;
      justify-content:center;margin:12px 0;"></div>

    <button onclick="downloadAllImages()" style="width:100%;padding:10px;
      background:#198754;color:#fff;border:none;border-radius:8px;">
      ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙˆØ±
    </button>

    <button class="close-btn" onclick="goHome()">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø£Ø¯Ø§Ø©</button>
  </div>
</div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>

<script>
function hideAll(){document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'))}
function goHome(){hideAll();home.classList.add('active')}
function openTool(id){hideAll();document.getElementById(id).classList.add('active')}

/* ===== IMAGE TO PDF (FIXED) ===== */
let images=[];
imageInput.onchange=e=>{
  preview.innerHTML='';
  images=[...e.target.files];
  images.forEach(f=>{
    let r=new FileReader();
    r.onload=()=>{let i=new Image();i.src=r.result;i.width=60;preview.appendChild(i)};
    r.readAsDataURL(f);
  });
};

async function generatePDF(){
  if(!images.length){alert('Ø§Ø®ØªØ± ØµÙˆØ±');return;}
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF();

  for(let i=0;i<images.length;i++){
    let d=await new Promise(res=>{
      let r=new FileReader();
      r.onload=()=>res(r.result);
      r.readAsDataURL(images[i]);
    });
    if(i) pdf.addPage();
    pdf.addImage(d,'JPEG',0,0,210,297);
  }

  const blob=pdf.output('blob');
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;
  a.download='images.pdf';
  a.target='_self';
  document.body.appendChild(a);
  a.click();
  setTimeout(()=>{URL.revokeObjectURL(url);a.remove()},300);
}

/* ===== PDF EXTRACT (FIXED) ===== */
let extracted=[];
pdfInput.onchange=async ()=>{
  pdfImages.innerHTML='';
  extracted=[];
  const buf=await pdfInput.files[0].arrayBuffer();
  const pdf=await pdfjsLib.getDocument({data:buf}).promise;

  for(let i=1;i<=pdf.numPages;i++){
    const page=await pdf.getPage(i);
    const vp=page.getViewport({scale:2});
    const c=document.createElement('canvas');
    c.width=vp.width;c.height=vp.height;
    await page.render({canvasContext:c.getContext('2d'),viewport:vp}).promise;
    const d=c.toDataURL();
    extracted.push(d);
    let im=new Image();im.src=d;im.width=60;pdfImages.appendChild(im);
  }
};

function downloadAllImages(){
  extracted.forEach((d,i)=>{
    fetch(d)
    .then(r=>r.blob())
    .then(b=>{
      const u=URL.createObjectURL(b);
      const a=document.createElement('a');
      a.href=u;
      a.download='image-'+(i+1)+'.png';
      a.target='_self';
      document.body.appendChild(a);
      a.click();
      setTimeout(()=>{URL.revokeObjectURL(u);a.remove()},200);
    });
  });
}
</script>

</body>
</html>
